<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.134.3"><meta name=description content><meta name=author content="thienlh@thienlu.com"><link rel=icon href=../../images/favicon.png type=image/png><title>Blog 1 :: Internship Report</title>
<link href=../../css/nucleus.css?1765299477 rel=stylesheet><link href=../../css/fontawesome-all.min.css?1765299477 rel=stylesheet><link href=../../css/hybrid.css?1765299477 rel=stylesheet><link href=../../css/featherlight.min.css?1765299477 rel=stylesheet><link href=../../css/perfect-scrollbar.min.css?1765299477 rel=stylesheet><link href=../../css/auto-complete.css?1765299477 rel=stylesheet><link href=../../css/atom-one-dark-reasonable.css?1765299477 rel=stylesheet><link href=../../css/theme.css?1765299477 rel=stylesheet><link href=../../css/hugo-theme.css?1765299477 rel=stylesheet><link href=../../css/theme-workshop.css?1765299477 rel=stylesheet><script src=../../js/jquery-3.3.1.min.js?1765299477></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=../../3-blogstranslated/3.1-blog1/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=../../><svg id="Layer_1" data-name="Layer 1" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff}.cls-2{fill:#f90;fill-rule:evenodd}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09 10.85a4.7 4.7.0 00.19 1.48 7.73 7.73.0 00.54 1.19.77.77.0 01.12.38.64.64.0 01-.32.49l-1 .7a.83.83.0 01-.44.15.69.69.0 01-.49-.23 3.8 3.8.0 01-.6-.77q-.25-.42-.51-1a6.14 6.14.0 01-4.89 2.3 4.54 4.54.0 01-3.32-1.19 4.27 4.27.0 01-1.22-3.2 4.28 4.28.0 011.46-3.4A6.06 6.06.0 017.69 6.46a12.47 12.47.0 011.76.13q.92.13 1.91.36V5.73a3.65 3.65.0 00-.79-2.66A3.81 3.81.0 007.86 2.3a7.71 7.71.0 00-1.79.22 12.78 12.78.0 00-1.79.57 4.55 4.55.0 01-.58.22h-.26q-.35.0-.35-.52V2a1.09 1.09.0 01.12-.58 1.2 1.2.0 01.47-.35A10.88 10.88.0 015.77.32 10.19 10.19.0 018.36.0a6 6 0 014.35 1.35 5.49 5.49.0 011.38 4.09zM7.34 13.38a5.36 5.36.0 001.72-.31A3.63 3.63.0 0010.63 12 2.62 2.62.0 0011.19 11a5.63 5.63.0 00.16-1.44v-.7a14.35 14.35.0 00-1.53-.28 12.37 12.37.0 00-1.56-.1 3.84 3.84.0 00-2.47.67A2.34 2.34.0 005 11a2.35 2.35.0 00.61 1.76A2.4 2.4.0 007.34 13.38zm13.35 1.8a1 1 0 01-.64-.16 1.3 1.3.0 01-.35-.65L15.81 1.51a3 3 0 01-.15-.67.36.36.0 01.41-.41H17.7a1 1 0 01.65.16 1.4 1.4.0 01.33.65l2.79 11 2.59-11A1.17 1.17.0 0124.39.6a1.1 1.1.0 01.67-.16H26.4a1.1 1.1.0 01.67.16 1.17 1.17.0 01.32.65L30 12.39 32.88 1.25A1.39 1.39.0 0133.22.6a1 1 0 01.65-.16h1.54a.36.36.0 01.41.41 1.36 1.36.0 010 .26 3.64 3.64.0 01-.12.41l-4 12.86a1.3 1.3.0 01-.35.65 1 1 0 01-.64.16H29.25a1 1 0 01-.67-.17 1.26 1.26.0 01-.32-.67L25.67 3.64l-2.56 10.7a1.26 1.26.0 01-.32.67 1 1 0 01-.67.17zm21.36.44a11.28 11.28.0 01-2.56-.29 7.44 7.44.0 01-1.92-.67 1 1 0 01-.61-.93v-.84q0-.52.38-.52a.9.9.0 01.31.06l.42.17a8.77 8.77.0 001.83.58 9.78 9.78.0 002 .2 4.48 4.48.0 002.43-.55 1.76 1.76.0 00.86-1.57 1.61 1.61.0 00-.45-1.16A4.29 4.29.0 0043 9.22l-2.41-.76A5.15 5.15.0 0138 6.78a3.94 3.94.0 01-.83-2.41 3.7 3.7.0 01.45-1.85 4.47 4.47.0 011.19-1.37 5.27 5.27.0 011.7-.86A7.4 7.4.0 0142.6.0a8.87 8.87.0 011.12.07q.57.07 1.08.19t.95.26a4.27 4.27.0 01.7.29 1.59 1.59.0 01.49.41.94.94.0 01.15.55v.79q0 .52-.38.52a1.76 1.76.0 01-.64-.2 7.74 7.74.0 00-3.2-.64 4.37 4.37.0 00-2.21.47 1.6 1.6.0 00-.79 1.48 1.58 1.58.0 00.49 1.18 4.94 4.94.0 001.83.92L44.55 7a5.08 5.08.0 012.57 1.6A3.76 3.76.0 0147.9 11a4.21 4.21.0 01-.44 1.93 4.4 4.4.0 01-1.21 1.47 5.43 5.43.0 01-1.85.93A8.25 8.25.0 0142.05 15.62z"/><path class="cls-2" d="M45.19 23.81C39.72 27.85 31.78 30 25 30A36.64 36.64.0 01.22 20.57c-.51-.46-.06-1.09.56-.74A49.78 49.78.0 0025.53 26.4 49.23 49.23.0 0044.4 22.53C45.32 22.14 46.1 23.14 45.19 23.81z"/><path class="cls-2" d="M47.47 21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74 3.13-2.2 8.27-1.57 8.86-.83s-.16 5.89-3.09 8.35c-.45.38-.88.18-.68-.32C46.69 25.8 48.17 22.11 47.47 21.21z"/></svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=../../js/lunr.min.js?1765299477></script><script type=text/javascript src=../../js/auto-complete.js?1765299477></script><script type=text/javascript>var baseurl="https://thienluhoan.github.io/workshop-template/"</script><script type=text/javascript src=../../js/search.js?1765299477></script></div><div class=highlightable><ul class=topics><li data-nav-id=/1-worklog/ title=Worklog class=dd-item><a href=../../1-worklog/><b>1. </b>Worklog
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/1-worklog/1.1-week1/ title="Week 1 Worklog" class=dd-item><a href=../../1-worklog/1.1-week1/><b>1.1. </b>Week 1 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.2-week2/ title="Week 2 Worklog" class=dd-item><a href=../../1-worklog/1.2-week2/><b>1.2. </b>Week 2 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.3-week3/ title="Week 3 Worklog" class=dd-item><a href=../../1-worklog/1.3-week3/><b>1.3. </b>Week 3 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.4-week4/ title="Week 4 Worklog" class=dd-item><a href=../../1-worklog/1.4-week4/><b>1.4. </b>Week 4 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.5-week5/ title="Week 5 Worklog" class=dd-item><a href=../../1-worklog/1.5-week5/><b>1.5. </b>Week 5 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.6-week6/ title="Week 6 Worklog" class=dd-item><a href=../../1-worklog/1.6-week6/><b>1.6. </b>Week 6 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.7-week7/ title="Week 7 Worklog" class=dd-item><a href=../../1-worklog/1.7-week7/><b>1.7. </b>Week 7 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.8-week8/ title="Week 8 Worklog" class=dd-item><a href=../../1-worklog/1.8-week8/><b>1.8. </b>Week 8 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.9-week9/ title="Week 9 Worklog" class=dd-item><a href=../../1-worklog/1.9-week9/><b>1.9. </b>Week 9 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.10-week10/ title="Week 10 Worklog" class=dd-item><a href=../../1-worklog/1.10-week10/><b>1.10. </b>Week 10 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.11-week11/ title="Week 11 Worklog" class=dd-item><a href=../../1-worklog/1.11-week11/><b>1.11. </b>Week 11 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.12-week12/ title="Week 12 Worklog" class=dd-item><a href=../../1-worklog/1.12-week12/><b>1.12. </b>Week 12 Worklog
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/2-proposal/ title=Proposal class=dd-item><a href=../../2-proposal/><b>2. </b>Proposal
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/ title="Translated Blogs" class="dd-item
parent"><a href=../../3-blogstranslated/><b>3. </b>Translated Blogs
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/3-blogstranslated/3.1-blog1/ title="Blog 1" class="dd-item
active"><a href=../../3-blogstranslated/3.1-blog1/><b>3.1. </b>Blog 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/3.2-blog2/ title="Blog 2" class=dd-item><a href=../../3-blogstranslated/3.2-blog2/><b>3.2. </b>Blog 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/3.3-blog3/ title="Blog 3" class=dd-item><a href=../../3-blogstranslated/3.3-blog3/><b>3.3. </b>Blog 3
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/4-eventparticipated/ title="Events Participated" class=dd-item><a href=../../4-eventparticipated/><b>4. </b>Events Participated
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/4-eventparticipated/4.1-event1/ title="AWS First Cloud Journey Community Day" class=dd-item><a href=../../4-eventparticipated/4.1-event1/><b>4.1. </b>AWS First Cloud Journey Community Day
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/4-eventparticipated/4.2-event2/ title="Kick-off AWS First Cloud Journey Workforce OJT FALL 2025" class=dd-item><a href=../../4-eventparticipated/4.2-event2/><b>4.2. </b>Kick-off AWS First Cloud Journey Workforce OJT FALL 2025
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/4-eventparticipated/4.3-event3/ title="Workshop: Data Science on AWS" class=dd-item><a href=../../4-eventparticipated/4.3-event3/><b>4.3. </b>Workshop: Data Science on AWS
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/4-eventparticipated/4.4-event4/ title="AWS AI/ML & GenAI Workshop" class=dd-item><a href=../../4-eventparticipated/4.4-event4/><b>4.4. </b>AWS AI/ML & GenAI Workshop
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/4-eventparticipated/4.5-event5/ title="AWS DevOps & Modern Operations" class=dd-item><a href=../../4-eventparticipated/4.5-event5/><b>4.5. </b>AWS DevOps & Modern Operations
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/4-eventparticipated/4.6-event6/ title="AWS Security Specialty Workshop" class=dd-item><a href=../../4-eventparticipated/4.6-event6/><b>4.6. </b>AWS Security Specialty Workshop
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/4-eventparticipated/4.7-event7/ title="CloudThinker: Agentic AI & Orchestration on AWS" class=dd-item><a href=../../4-eventparticipated/4.7-event7/><b>4.7. </b>CloudThinker: Agentic AI & Orchestration on AWS
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/5-workshop/ title=Workshop class=dd-item><a href=../../5-workshop/><b>5. </b>Workshop
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/5-workshop/5.1-workshop-overview/ title="Workshop Overview" class=dd-item><a href=../../5-workshop/5.1-workshop-overview/><b>5.1. </b>Workshop Overview
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.2-prerequisite/ title=Prerequisites class=dd-item><a href=../../5-workshop/5.2-prerequisite/><b>5.2. </b>Prerequisites
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.3-architecture/ title="Project Architecture" class=dd-item><a href=../../5-workshop/5.3-architecture/><b>5.3. </b>Project Architecture
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.4-setup-aws/ title="Setup AWS Environment" class=dd-item><a href=../../5-workshop/5.4-setup-aws/><b>5.4. </b>Setup AWS Environment
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.5-database-setup/ title="Database Setup (DynamoDB)" class=dd-item><a href=../../5-workshop/5.5-database-setup/><b>5.5. </b>Database Setup (DynamoDB)
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.6-authentication/ title="Authentication Service" class=dd-item><a href=../../5-workshop/5.6-authentication/><b>5.6. </b>Authentication Service
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.7-backend-services/ title="Backend Services" class=dd-item><a href=../../5-workshop/5.7-backend-services/><b>5.7. </b>Backend Services
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.8-frontend/ title="Frontend Development" class=dd-item><a href=../../5-workshop/5.8-frontend/><b>5.8. </b>Frontend Development
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.9-deployment/ title=Deployment class=dd-item><a href=../../5-workshop/5.9-deployment/><b>5.9. </b>Deployment
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.10-testing/ title="Testing & Monitoring" class=dd-item><a href=../../5-workshop/5.10-testing/><b>5.10. </b>Testing & Monitoring
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.11-cleanup/ title=Cleanup class=dd-item><a href=../../5-workshop/5.11-cleanup/><b>5.11. </b>Cleanup
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/6-self-evaluation/ title=Self-Assessment class=dd-item><a href=../../6-self-evaluation/><b>6. </b>Self-Assessment
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/7-feedback/ title="Sharing and Feedback" class=dd-item><a href=../../7-feedback/><b>7. </b>Sharing and Feedback
<i class="fas fa-check read-icon"></i></a></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://www.facebook.com/groups/awsstudygroupfcj/><i class='fab fa-facebook'></i> AWS Study Group</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value"><option id=en value=https://thienluhoan.github.io/workshop-template/3-blogstranslated/3.1-blog1/ selected>English</option><option id=vi value=https://thienluhoan.github.io/workshop-template/vi/3-blogstranslated/3.1-blog1/>Tiếng Việt</option></select><svg id="Capa_1" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><polygon points="0,63.75 127.5,191.25 255,63.75"/></g></g></svg></div></a></li><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></section><section id=footer><left><b>Workshop</b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title=Migrate alt="web counter" border=0></a><br><b><a href=https://cloudjourney.awsstudygroup.com/>Cloud Journey</a></b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" alt="web counter" border=0>
</left><left><br><br><b>Last Updated</b><br><i><span id=lastUpdated style=color:orange></span>
</i><script>const today=new Date,formattedDate=today.toLocaleDateString("en-GB");document.getElementById("lastUpdated").textContent=formattedDate</script></left><left><br><br><b>Team</b><br><i><a href=https://www.facebook.com/groups/660548818043427 style=color:orange>First Cloud Journey</a><br></i></left><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i>
</a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=../../>Internship Report</a> > <a href=../../3-blogstranslated/>Translated Blogs</a> > Blog 1</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#typical-architecture>Typical architecture</a><ul><li><a href=#the-all-or-nothing-health-check-problem>The all-or-nothing health check problem</a></li><li><a href=#consider-this-example>Consider this example:</a></li></ul></li><li><a href=#solution-overview>Solution overview</a></li><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#walkthrough>Walkthrough</a><ul><li><a href=#configure-environment-variables>Configure environment variables</a></li><li><a href=#create-eks-clusters-in-region-1-and-region-2>Create EKS clusters in Region 1 and Region 2</a></li><li><a href=#create-ingressclass-configuration>Create IngressClass configuration</a></li></ul></li><li><a href=#deploy-app1-and-app2-on-the-eks-clusters>Deploy app1 and app2 on the EKS clusters</a></li><li><a href=#configure-route-53-health-checks-for-app1-and-app2>Configure Route 53 health checks for app1 and app2</a></li><li><a href=#configure-route-53-alias-records-for-app1-and-app2>Configure Route 53 alias records for app1 and app2</a></li><li><a href=#test-application-failure>Test application failure</a></li><li><a href=#things-to-know>Things to know</a></li><li><a href=#cleaning-up>Cleaning up</a></li><li><a href=#conclusion>Conclusion</a></li><li><a href=#about-the-authors>About the authors</a><ul><li><a href=#dumlu-timuralp>Dumlu Timuralp</a></li><li><a href=#pratik-mankad>Pratik Mankad</a></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Blog 1</h1><h1 id=implementing-granular-failover-in-multi-region-amazon-eks>Implementing granular failover in multi-Region Amazon EKS</h1><p>by Dumlu Timuralp and Pratik R. Mankad | on 18 SEP 2025 | in Amazon Elastic Kubernetes Service, Amazon Route 53, Technical How-to | Permalink | Share</p><p>Enterprises across industries operate tens of millions of Amazon Elastic Kubernetes Service (Amazon EKS) clusters annually, supporting use cases from web/mobile applications to data processing, machine learning (ML), generative AI, gaming, and Internet of Things (IoT). As organizations increasingly adopt multi-tenant platform models where multiple application teams share an EKS cluster, they need more granular control over application availability in their multi-Region architectures—particularly for serving global users and meeting strict regulatory requirements.</p><p>Although multi-tenant models optimize resource usage and reduce operational overhead, they present challenges when applications need individualized Recovery Point Objective (RPO) and Recovery Time Objective (RTO) targets across multiple AWS Regions. Traditional approaches force uniform failover policies across all applications where a single application’s failure creates an unnecessary compromise between operational efficiency and application-specific resilience.</p><p>In this post, we demonstrate how to configure Amazon Route 53 to enable unique failover behavior for each application within your multi-tenant Amazon EKS environment across AWS Regions, which allows you to maintain the cost benefits of shared infrastructure while meeting diverse availability requirements.</p><h2 id=typical-architecture>Typical architecture</h2><p>Before diving into the solution, we demonstrate how a typical multi-Region multi-tenant Amazon EKS architecture is structured, and the key components that enable Regional traffic routing. Figure 1 consists of the following key components:</p><ul><li>Route 53
Routes traffic to the Application Load Balancer (ALB) in the respective Region
Makes sure of high availability and resiliency during failure events</li><li>AWS Load Balancer Controller
Exposes applications running on the EKS cluster through ALB
Uses IP target type to register application Pods to the ALB</li></ul><p>The Route 53 configuration details are as follows:</p><ul><li>Regional Routing
Each AWS Region uses a Route 53 alias record to route traffic to its Region-specific ALB.
Example: app1.example.com points to ALB in Region 1
Example: app2.example.com points to ALB in Region 2</li><li>Health monitoring
“Evaluate target health” feature in alias records:
Continuously monitor ALB health
Automatically remove unhealthy ALBs from DNS responses</li><li>Request routing
Provide routing policies for active-active architecture</li></ul><p><img alt=Blog src=../../images/3-Blog/blog_1_0.jpg></p><p>Figure 1: Multi-Region, multi-tenant Amazon EKS platform architecture</p><h3 id=the-all-or-nothing-health-check-problem>The all-or-nothing health check problem</h3><p>The Route 53 Evaluate target health attribute in alias records continuously monitors the health of the specified ALB target. An ALB is considered healthy only if each of its configured target groups contains at least one healthy target. If any target group becomes unhealthy, then Route 53 marks the entire ALB as unhealthy and removes it from DNS responses, redirecting users to the remaining healthy Region(s).</p><p>This reflects the cascading failure effect in multi-tenant environments:</p><ul><li>When one application fails, Route 53 marks the entire ALB as unhealthy</li><li>All traffic redirects to other AWS Region(s), even for healthy applications</li><li>Healthy applications unnecessarily experience increased latency</li></ul><h3 id=consider-this-example>Consider this example:</h3><ul><li>app1.example.com fails in Region 1</li><li>app2.example.com remains healthy in Region 1</li><li>Route 53 redirects all traffic to Region 2</li><li>Users of healthy app2 experience unnecessary latency</li><li>Healthy applications are impacted by unrelated service failures</li></ul><p>This behavior forces users to choose between two sub-optimal options:</p><ul><li>Accept complete Regional failure when any single microservice fails</li><li>Deploy separate ALBs for each microservice, thus increasing both operational complexity and costs</li></ul><p>In the following sections, we present a solution that addresses these architectural challenges and provides a more resilient multi-Region deployment model.</p><h2 id=solution-overview>Solution overview</h2><p>To address the challenge, we propose a solution that provides granular failover control at the application level. Figure 2 shows the solution architecture. The solution consists of two key configurations:</p><p>Application-specific health checks</p><ul><li>Configure dedicated Route 53 health checks for each application in each AWS Region</li><li>Associate each health check with the respective Route 53 alias record</li><li>Set Evaluate Target Health to No in alias records</li></ul><p>Granular failover control</p><ul><li>Route 53 monitors application health independently</li><li>During failures, affected application’s traffic is redirected</li><li>Healthy applications continue serving traffic from their original AWS Region.</li></ul><p><img alt=Blog src=../../images/3-Blog/blog_1_1.jpg></p><p>Figure 2: Solution architecture</p><p>This architecture provides the following key benefits:</p><p>Enhanced control and monitoring:
Provides granular monitoring at the application level (target group)
Eliminates the limitation of monitoring only at the ALB level
Intelligent failover management:
Selective failover for individual applications
Protects healthy applications when a single service fails
Maintains optimal routing for unaffected services
Organizations can do the following:
Maintain multi-tenant cost benefits
Achieve application-specific resilience
Meet diverse availability requirements
Avoid unnecessary cross-Region routing</p><h2 id=prerequisites>Prerequisites</h2><p>he following prerequisites are necessary to complete the solution:</p><p>An AWS account
An existing public hosted zone in Route 53, or you can register a new domain with Route 53 or use it for an existing domain
AWS Command Line Interface (AWS CLI)
eksctl
kubectl
kubectx (optional)
AWS CloudShell (optional)</p><h2 id=walkthrough>Walkthrough</h2><p>The following steps walk you through this solution.</p><h3 id=configure-environment-variables>Configure environment variables</h3><p>Replace the values in the following example with your own values and create the variables.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export ACCOUNT_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>aws sts get-caller-identity --output text --query Account<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>export Region1<span style=color:#f92672>=</span>eu-west-1 
</span></span><span style=display:flex><span>export Region2<span style=color:#f92672>=</span>eu-central-1
</span></span><span style=display:flex><span>export ALBName<span style=color:#f92672>=</span>demoalb
</span></span><span style=display:flex><span>export Region1ClusterName<span style=color:#f92672>=</span>cluster1
</span></span><span style=display:flex><span>export Region2ClusterName<span style=color:#f92672>=</span>cluster2
</span></span><span style=display:flex><span>export app1hostname<span style=color:#f92672>=</span>app1.example.com
</span></span><span style=display:flex><span>export app2hostname<span style=color:#f92672>=</span>app2.example.com
</span></span><span style=display:flex><span>export HostedZoneName<span style=color:#f92672>=</span>example.com
</span></span><span style=display:flex><span>export HostedZoneId<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>aws route53 list-hosted-zones-by-name --dns-name $HostedZoneName --query <span style=color:#e6db74>&#39;HostedZones[0].Id&#39;</span> --output text | cut -d<span style=color:#e6db74>&#39;/&#39;</span> -f3<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><h3 id=create-eks-clusters-in-region-1-and-region-2>Create EKS clusters in Region 1 and Region 2</h3><ol><li>Create an EKS cluster in Region 1</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>eksctl create cluster --name<span style=color:#f92672>=</span>$Region1ClusterName --enable-auto-mode --region<span style=color:#f92672>=</span>$Region1
</span></span></code></pre></div><ol start=2><li>Wait for the cluster state to become Active. This takes approximately 12 minutes.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws eks describe-cluster --name $Region1ClusterName --region $Region1 --output json --query <span style=color:#e6db74>&#39;cluster.status&#39;</span>
</span></span></code></pre></div><ol start=3><li>Create an EKS cluster in Region 2.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>eksctl create cluster --name<span style=color:#f92672>=</span>$Region2ClusterName --enable-auto-mode --region<span style=color:#f92672>=</span>$Region2
</span></span></code></pre></div><ol start=4><li>Wait for the cluster state to become Active. This takes approximately 12 minutes.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws eks describe-cluster --name $Region2ClusterName --region $Region2 --output json --query <span style=color:#e6db74>&#39;cluster.status&#39;</span>
</span></span></code></pre></div><ol start=5><li>eksctl updates your kubeconfig file as it completes the creation of each cluster. Use kubectl to list the nodes in each cluster. Use kubectx or manually switch between the clusters.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get nodes
</span></span></code></pre></div><h3 id=create-ingressclass-configuration>Create IngressClass configuration</h3><ol><li>Run the following command to create the IngressClassParams and IngressClass on the cluster in Region 1.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -s https://raw.githubusercontent.com/aws-samples/multi-region-ingress/refs/heads/main/ingressclassconfiguration.yaml | kubectl apply -f -
</span></span></code></pre></div><ol start=2><li>Verify that the resources are created.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get ingressclass,ingressclassparams
</span></span></code></pre></div><ol start=3><li>Repeat Steps 1 and 2 for the cluster in Region 2.</li></ol><h2 id=deploy-app1-and-app2-on-the-eks-clusters>Deploy app1 and app2 on the EKS clusters</h2><ol><li>We use a manifest to deploy the applications on the cluster in Region 1. The manifest creates the following:
a deployment, with a single replica, for each application
a service for each deployment
an ingress that forwards http requests to the services</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -s https://github.com/aws-samples/multi-region-ingress/blob/main/multitenant.yaml | envsubst | kubectl apply -f -
</span></span></code></pre></div><ol start=2><li>Verify that the resources are created. You should see two deployments, two services, and an ingress in the output. Confirm that the pod status is running</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get all,ingress
</span></span></code></pre></div><ol start=3><li>Repeat Steps 1 and 2 for the cluster in Region 2.
The applications that we deployed are simple web servers that display an HTML page that includes the application name, pod name, AWS Region, and AWS Availability Zone (AZ). We show this as a sample in Figure 3 and Figure 4. We test the access when we define the Route 53 records in the next few steps.</li></ol><p><img alt=Blog src=../../images/3-Blog/blog_1_2.jpg></p><p>Figure 3: App1 web page</p><p><img alt=Blog src=../../images/3-Blog/blog_1_3.jpg></p><p>Figure 4: App2 web page</p><h2 id=configure-route-53-health-checks-for-app1-and-app2>Configure Route 53 health checks for app1 and app2</h2><ol><li>Define environment variables for the ALBs created previously.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export Region1ALB<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>aws elbv2 describe-load-balancers --region $Region1 --query <span style=color:#e6db74>&#34;LoadBalancers[?contains(LoadBalancerName, &#39;</span>$ALBName<span style=color:#e6db74>&#39;)].DNSName | [0]&#34;</span> --output text<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>export Region2ALB<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>aws elbv2 describe-load-balancers --region $Region2 --query <span style=color:#e6db74>&#34;LoadBalancers[?contains(LoadBalancerName, &#39;</span>$ALBName<span style=color:#e6db74>&#39;)].DNSName | [0]&#34;</span> --output text<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><ol start=2><li>Configure the health checks for app1 in Region 1 and Region 2.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws route53 create-health-check --caller-reference <span style=color:#e6db74>&#34;Region1App1-</span><span style=color:#66d9ef>$(</span>date +%s<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--health-check-config <span style=color:#e6db74>&#34;{\&#34;Port\&#34;:80,\&#34;Type\&#34;:\&#34;HTTP\&#34;,\&#34;ResourcePath\&#34;:\&#34;/app1health\&#34;,\&#34;FullyQualifiedDomainName\&#34;:\&#34;</span>$Region1ALB<span style=color:#e6db74>\&#34;,\&#34;RequestInterval\&#34;:30,\&#34;FailureThreshold\&#34;:3,\&#34;MeasureLatency\&#34;:true,\&#34;Inverted\&#34;:false,\&#34;Disabled\&#34;:false,\&#34;EnableSNI\&#34;:false}&#34;</span>
</span></span><span style=display:flex><span>aws route53 create-health-check --caller-reference <span style=color:#e6db74>&#34;Region2App1-</span><span style=color:#66d9ef>$(</span>date +%s<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--health-check-config <span style=color:#e6db74>&#34;{\&#34;Port\&#34;:80,\&#34;Type\&#34;:\&#34;HTTP\&#34;,\&#34;ResourcePath\&#34;:\&#34;/app1health\&#34;,\&#34;FullyQualifiedDomainName\&#34;:\&#34;</span>$Region2ALB<span style=color:#e6db74>\&#34;,\&#34;RequestInterval\&#34;:30,\&#34;FailureThreshold\&#34;:3,\&#34;MeasureLatency\&#34;:true,\&#34;Inverted\&#34;:false,\&#34;Disabled\&#34;:false,\&#34;EnableSNI\&#34;:false}&#34;</span>
</span></span></code></pre></div><ol start=3><li>Configure the health checks for app2 in Region 1 and Region 2.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws route53 create-health-check --caller-reference <span style=color:#e6db74>&#34;Region1App1-</span><span style=color:#66d9ef>$(</span>date +%s<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--health-check-config <span style=color:#e6db74>&#34;{\&#34;Port\&#34;:80,\&#34;Type\&#34;:\&#34;HTTP\&#34;,\&#34;ResourcePath\&#34;:\&#34;/app2health\&#34;,\&#34;FullyQualifiedDomainName\&#34;:\&#34;</span>$Region1ALB<span style=color:#e6db74>\&#34;,\&#34;RequestInterval\&#34;:30,\&#34;FailureThreshold\&#34;:3,\&#34;MeasureLatency\&#34;:true,\&#34;Inverted\&#34;:false,\&#34;Disabled\&#34;:false,\&#34;EnableSNI\&#34;:false}&#34;</span>
</span></span><span style=display:flex><span>aws route53 create-health-check --caller-reference <span style=color:#e6db74>&#34;Region2App1-</span><span style=color:#66d9ef>$(</span>date +%s<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--health-check-config <span style=color:#e6db74>&#34;{\&#34;Port\&#34;:80,\&#34;Type\&#34;:\&#34;HTTP\&#34;,\&#34;ResourcePath\&#34;:\&#34;/app2health\&#34;,\&#34;FullyQualifiedDomainName\&#34;:\&#34;</span>$Region2ALB<span style=color:#e6db74>\&#34;,\&#34;RequestInterval\&#34;:30,\&#34;FailureThreshold\&#34;:3,\&#34;MeasureLatency\&#34;:true,\&#34;Inverted\&#34;:false,\&#34;Disabled\&#34;:false,\&#34;EnableSNI\&#34;:false}&#34;</span>
</span></span></code></pre></div><h2 id=configure-route-53-alias-records-for-app1-and-app2>Configure Route 53 alias records for app1 and app2</h2><ol><li>Define environment variables for the health checks created earlier.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export HealthCheckRegion1App1Id<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>aws route53 list-health-checks <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --query <span style=color:#e6db74>&#34;HealthChecks[?HealthCheckConfig.FullyQualifiedDomainName==&#39;</span>$Region1ALB<span style=color:#e6db74>&#39; &amp;&amp; HealthCheckConfig.ResourcePath==&#39;/app1health&#39;] | [0].Id&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --output text<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>export HealthCheckRegion1App2Id<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>aws route53 list-health-checks <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --query <span style=color:#e6db74>&#34;HealthChecks[?HealthCheckConfig.FullyQualifiedDomainName==&#39;</span>$Region1ALB<span style=color:#e6db74>&#39; &amp;&amp; HealthCheckConfig.ResourcePath==&#39;/app2health&#39;] | [0].Id&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --output text<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>export HealthCheckRegion2App1Id<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>aws route53 list-health-checks <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --query <span style=color:#e6db74>&#34;HealthChecks[?HealthCheckConfig.FullyQualifiedDomainName==&#39;</span>$Region2ALB<span style=color:#e6db74>&#39; &amp;&amp; HealthCheckConfig.ResourcePath==&#39;/app1health&#39;] | [0].Id&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --output text<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>export HealthCheckRegion2App2Id<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>aws route53 list-health-checks <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --query <span style=color:#e6db74>&#34;HealthChecks[?HealthCheckConfig.FullyQualifiedDomainName==&#39;</span>$Region2ALB<span style=color:#e6db74>&#39; &amp;&amp; HealthCheckConfig.ResourcePath==&#39;/app2health&#39;] | [0].Id&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --output text<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><ol start=2><li>Define environment variables for the ALBs’ CanonicalHostedZoneId. We need to use it when creating the alias records in the next steps.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export Region1ALBHostedZoneId<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>aws elbv2 describe-load-balancers --region $Region1 --query <span style=color:#e6db74>&#34;LoadBalancers[?DNSName==&#39;</span>$Region1ALB<span style=color:#e6db74>&#39;].CanonicalHostedZoneId&#34;</span> --output text<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>export Region2ALBHostedZoneId<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>aws elbv2 describe-load-balancers --region $Region2 --query <span style=color:#e6db74>&#34;LoadBalancers[?DNSName==&#39;</span>$Region2ALB<span style=color:#e6db74>&#39;].CanonicalHostedZoneId&#34;</span> --output text<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><ol start=3><li>Create the alias records for app1. In this example we use latency based routing policy in each record.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws route53 change-resource-record-sets --hosted-zone-id $HostedZoneId <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --change-batch <span style=color:#e6db74>&#34;{\&#34;Changes\&#34;:[{\&#34;Action\&#34;:\&#34;CREATE\&#34;,\&#34;ResourceRecordSet\&#34;:{\&#34;Name\&#34;:\&#34;</span>$app1hostname<span style=color:#e6db74>\&#34;,\&#34;Type\&#34;:\&#34;A\&#34;,\&#34;SetIdentifier\&#34;:\&#34;</span>$Region1<span style=color:#e6db74>\&#34;,\&#34;Region\&#34;:\&#34;</span>$Region1<span style=color:#e6db74>\&#34;,\&#34;HealthCheckId\&#34;:\&#34;</span>$HealthCheckRegion1App1Id<span style=color:#e6db74>\&#34;,\&#34;AliasTarget\&#34;:{\&#34;HostedZoneId\&#34;:\&#34;</span>$Region1ALBHostedZoneId<span style=color:#e6db74>\&#34;,\&#34;DNSName\&#34;:\&#34;</span>$Region1ALB<span style=color:#e6db74>\&#34;,\&#34;EvaluateTargetHealth\&#34;:false}}}]}&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>aws route53 change-resource-record-sets --hosted-zone-id $HostedZoneId <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --change-batch <span style=color:#e6db74>&#34;{\&#34;Changes\&#34;:[{\&#34;Action\&#34;:\&#34;CREATE\&#34;,\&#34;ResourceRecordSet\&#34;:{\&#34;Name\&#34;:\&#34;</span>$app1hostname<span style=color:#e6db74>\&#34;,\&#34;Type\&#34;:\&#34;A\&#34;,\&#34;SetIdentifier\&#34;:\&#34;</span>$Region2<span style=color:#e6db74>\&#34;,\&#34;Region\&#34;:\&#34;</span>$Region2<span style=color:#e6db74>\&#34;,\&#34;HealthCheckId\&#34;:\&#34;</span>$HealthCheckRegion2App1Id<span style=color:#e6db74>\&#34;,\&#34;AliasTarget\&#34;:{\&#34;HostedZoneId\&#34;:\&#34;</span>$Region2ALBHostedZoneId<span style=color:#e6db74>\&#34;,\&#34;DNSName\&#34;:\&#34;</span>$Region2ALB<span style=color:#e6db74>\&#34;,\&#34;EvaluateTargetHealth\&#34;:false}}}]}&#34;</span>
</span></span></code></pre></div><ol start=4><li>Verify that the alias records for app1 are successfully created in the Route 53 hosted zone.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws route53 list-resource-record-sets --hosted-zone-id $HostedZoneId --query <span style=color:#e6db74>&#34;ResourceRecordSets[?Name==&#39;</span>$app1hostname<span style=color:#e6db74>.&#39;]&#34;</span>
</span></span></code></pre></div><ol start=5><li>Create the alias records for app2. In this example we use a latency based routing policy in each record.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws route53 change-resource-record-sets --hosted-zone-id $HostedZoneId <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --change-batch <span style=color:#e6db74>&#34;{\&#34;Changes\&#34;:[{\&#34;Action\&#34;:\&#34;CREATE\&#34;,\&#34;ResourceRecordSet\&#34;:{\&#34;Name\&#34;:\&#34;</span>$app2hostname<span style=color:#e6db74>\&#34;,\&#34;Type\&#34;:\&#34;A\&#34;,\&#34;SetIdentifier\&#34;:\&#34;</span>$Region1<span style=color:#e6db74>\&#34;,\&#34;Region\&#34;:\&#34;</span>$Region1<span style=color:#e6db74>\&#34;,\&#34;HealthCheckId\&#34;:\&#34;</span>$HealthCheckRegion1App2Id<span style=color:#e6db74>\&#34;,\&#34;AliasTarget\&#34;:{\&#34;HostedZoneId\&#34;:\&#34;</span>$Region1ALBHostedZoneId<span style=color:#e6db74>\&#34;,\&#34;DNSName\&#34;:\&#34;</span>$Region1ALB<span style=color:#e6db74>\&#34;,\&#34;EvaluateTargetHealth\&#34;:false}}}]}&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>aws route53 change-resource-record-sets --hosted-zone-id $HostedZoneId <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --change-batch <span style=color:#e6db74>&#34;{\&#34;Changes\&#34;:[{\&#34;Action\&#34;:\&#34;CREATE\&#34;,\&#34;ResourceRecordSet\&#34;:{\&#34;Name\&#34;:\&#34;</span>$app2hostname<span style=color:#e6db74>\&#34;,\&#34;Type\&#34;:\&#34;A\&#34;,\&#34;SetIdentifier\&#34;:\&#34;</span>$Region2<span style=color:#e6db74>\&#34;,\&#34;Region\&#34;:\&#34;</span>$Region2<span style=color:#e6db74>\&#34;,\&#34;HealthCheckId\&#34;:\&#34;</span>$HealthCheckRegion2App2Id<span style=color:#e6db74>\&#34;,\&#34;AliasTarget\&#34;:{\&#34;HostedZoneId\&#34;:\&#34;</span>$Region2ALBHostedZoneId<span style=color:#e6db74>\&#34;,\&#34;DNSName\&#34;:\&#34;</span>$Region2ALB<span style=color:#e6db74>\&#34;,\&#34;EvaluateTargetHealth\&#34;:false}}}]}&#34;</span>
</span></span></code></pre></div><ol start=6><li>Verify that the alias records for app2 are successfully created in the Route 53 hosted zone.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws route53 list-resource-record-sets --hosted-zone-id $HostedZoneId --query <span style=color:#e6db74>&#34;ResourceRecordSets[?Name==&#39;</span>$app2hostname<span style=color:#e6db74>.&#39;]&#34;</span>
</span></span></code></pre></div><p>It may take a while for the DNS to propagate. Therefore, you may not have immediate access to the application domain names (app1.example.com and app2.example.com).</p><h2 id=test-application-failure>Test application failure</h2><p>With the configuration now in place, we can examine how the system responds to an individual application failure. Figure 5 illustrates the sequence of events during such a scenario. Under normal conditions, users located in Region 1 are always directed to applications in Region 1 because we created Route 53 alias records that use latency-based routing policy. Let’s assume app1 fails. In that case, users in Region 1 accessing app1 are redirected to Region 2, while users in Region 1 sending requests to app2 continue to be served by app2 in Region 1.</p><p><img alt=Blog src=../../images/3-Blog/blog_1_4.jpg></p><p>Figure 5: Application failure scenario</p><p>The following sequence of events is shown in Figure 5.</p><p>Both health checks are healthy
App1 workloads fail in Region 1
Route 53 health check (for app1 in Region 1) becomes unhealthy
Route 53 withdraws the Region 1 ALB from the DNS responses
All users are redirected to app1 in Region 2
Validate the behavior shown in Figure 5 by scaling down the deployment for app1 to zero replicas, which simulates an application failure. Use the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl scale deployment demoapp1 --replicas<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span></code></pre></div><p>We used the default timers in the Route 53 health checks in this scenario. Therefore, it takes several minutes for Route 53 to start redirecting user requests for app1 to Region 2. You can configure more aggressive timers for your use case to provide much quicker failover.</p><p>The key differentiator of this approach becomes immediately apparent: the Route 53 application-specific health checks detect only app1’s failure and redirect app1 traffic exclusively to Region 2. Meanwhile, app2 continues serving users from Region 1, maintaining optimal latency for healthy applications.</p><p>This selective failover behavior contrasts sharply with traditional ALB-level monitoring, where a single application failure forces all applications to fail over to another Region, unnecessarily impacting performance for healthy services. Our solution makes sure that failure isolation occurs at the application level, not the infrastructure level, providing true granular control in multi-tenant environments.</p><h2 id=things-to-know>Things to know</h2><ul><li>Each application consumes one rule for the application endpoint and one rule for the healthcheck endpoint on the ALB. Consider the maximum number of rules allowed per ALB when planning.</li><li>When creating an alias record using Route 53 console, Evaluate target health is automatically set to Yes. When using AWS CLI or other tools, you must explicitly set it.</li><li>You must configure Route 53 health checks for each application. Be mindful of the Route 53 health check pricing.</li><li>Route 53 health checkers that are based on HTTPS do not validate SSL/TLS certificates. Therefore, checks do not fail due to invalid or expired certificates.</li><li>Route 53 health checkers can’t monitor endpoints with IP addresses in local, private, non-routable, or multicast ranges. If your application runs in a private subnet, you can implement custom Route 53 health checks using CloudWatch alarms. A custom health check implementation using a Lambda function is demonstrated in this AWS post: Performing Route 53 health checks on private resources in a VPC with AWS Lambda and Amazon CloudWatch.</li><li>The ALB HTTP keepalive duration is crucial for clients to quickly detect failures in multi-tenant environments. For more information, go to Application Load Balancer enables configuring HTTP client keepalive duration.</li><li>This post is not applicable to path based application segregation on the same domain name (for example when app1 is example.com/app1 and app2 is example.com/app2).</li><li>Refer to Configuring DNS Failover to understand how health checks, alias records, and failover work in various scenarios.</li><li>Amazon Application Recovery Controller (ARC) is another AWS service to achieve Regional resiliency. However, ARC is out of scope for this post. For more details, consult the ARC Developer Guide.</li></ul><h2 id=cleaning-up>Cleaning up</h2><p>You continue to incur costs until deleting the infrastructure that you created for this post. Use the following commands to delete those resources.</p><p>Delete the EKS clusters using the following commands. eksctl automatically deletes all ELB resources (target groups, ALB, etc.), which are provisioned by ALB Controller as a result of the Kubernetes ingress requests.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>eksctl delete cluster --name<span style=color:#f92672>=</span>$Region1ClusterName --region<span style=color:#f92672>=</span>$Region1
</span></span><span style=display:flex><span>eksctl delete cluster --name<span style=color:#f92672>=</span>$Region2ClusterName --region<span style=color:#f92672>=</span>$Region2
</span></span></code></pre></div><p>Delete the Route 53 alias records.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws route53 change-resource-record-sets --hosted-zone-id $HostedZoneId <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --change-batch <span style=color:#e6db74>&#34;{\&#34;Changes\&#34;:[{\&#34;Action\&#34;:\&#34;DELETE\&#34;,\&#34;ResourceRecordSet\&#34;:{\&#34;Name\&#34;:\&#34;</span>$app1hostname<span style=color:#e6db74>\&#34;,\&#34;Type\&#34;:\&#34;A\&#34;,\&#34;SetIdentifier\&#34;:\&#34;</span>$Region1<span style=color:#e6db74>\&#34;,\&#34;Region\&#34;:\&#34;</span>$Region1<span style=color:#e6db74>\&#34;,\&#34;HealthCheckId\&#34;:\&#34;</span>$HealthCheckRegion1App1Id<span style=color:#e6db74>\&#34;,\&#34;AliasTarget\&#34;:{\&#34;HostedZoneId\&#34;:\&#34;</span>$Region1ALBHostedZoneId<span style=color:#e6db74>\&#34;,\&#34;DNSName\&#34;:\&#34;</span>$Region1ALB<span style=color:#e6db74>\&#34;,\&#34;EvaluateTargetHealth\&#34;:false}}}]}&#34;</span>
</span></span><span style=display:flex><span>aws route53 change-resource-record-sets --hosted-zone-id $HostedZoneId <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --change-batch <span style=color:#e6db74>&#34;{\&#34;Changes\&#34;:[{\&#34;Action\&#34;:\&#34;DELETE\&#34;,\&#34;ResourceRecordSet\&#34;:{\&#34;Name\&#34;:\&#34;</span>$app2hostname<span style=color:#e6db74>\&#34;,\&#34;Type\&#34;:\&#34;A\&#34;,\&#34;SetIdentifier\&#34;:\&#34;</span>$Region1<span style=color:#e6db74>\&#34;,\&#34;Region\&#34;:\&#34;</span>$Region1<span style=color:#e6db74>\&#34;,\&#34;HealthCheckId\&#34;:\&#34;</span>$HealthCheckRegion1App2Id<span style=color:#e6db74>\&#34;,\&#34;AliasTarget\&#34;:{\&#34;HostedZoneId\&#34;:\&#34;</span>$Region1ALBHostedZoneId<span style=color:#e6db74>\&#34;,\&#34;DNSName\&#34;:\&#34;</span>$Region1ALB<span style=color:#e6db74>\&#34;,\&#34;EvaluateTargetHealth\&#34;:false}}}]}&#34;</span>
</span></span><span style=display:flex><span>aws route53 change-resource-record-sets --hosted-zone-id $HostedZoneId <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --change-batch <span style=color:#e6db74>&#34;{\&#34;Changes\&#34;:[{\&#34;Action\&#34;:\&#34;DELETE\&#34;,\&#34;ResourceRecordSet\&#34;:{\&#34;Name\&#34;:\&#34;</span>$app1hostname<span style=color:#e6db74>\&#34;,\&#34;Type\&#34;:\&#34;A\&#34;,\&#34;SetIdentifier\&#34;:\&#34;</span>$Region2<span style=color:#e6db74>\&#34;,\&#34;Region\&#34;:\&#34;</span>$Region2<span style=color:#e6db74>\&#34;,\&#34;HealthCheckId\&#34;:\&#34;</span>$HealthCheckRegion2App1Id<span style=color:#e6db74>\&#34;,\&#34;AliasTarget\&#34;:{\&#34;HostedZoneId\&#34;:\&#34;</span>$Region2ALBHostedZoneId<span style=color:#e6db74>\&#34;,\&#34;DNSName\&#34;:\&#34;</span>$Region2ALB<span style=color:#e6db74>\&#34;,\&#34;EvaluateTargetHealth\&#34;:false}}}]}&#34;</span>
</span></span><span style=display:flex><span>aws route53 change-resource-record-sets --hosted-zone-id $HostedZoneId <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --change-batch <span style=color:#e6db74>&#34;{\&#34;Changes\&#34;:[{\&#34;Action\&#34;:\&#34;DELETE\&#34;,\&#34;ResourceRecordSet\&#34;:{\&#34;Name\&#34;:\&#34;</span>$app2hostname<span style=color:#e6db74>\&#34;,\&#34;Type\&#34;:\&#34;A\&#34;,\&#34;SetIdentifier\&#34;:\&#34;</span>$Region2<span style=color:#e6db74>\&#34;,\&#34;Region\&#34;:\&#34;</span>$Region2<span style=color:#e6db74>\&#34;,\&#34;HealthCheckId\&#34;:\&#34;</span>$HealthCheckRegion2App2Id<span style=color:#e6db74>\&#34;,\&#34;AliasTarget\&#34;:{\&#34;HostedZoneId\&#34;:\&#34;</span>$Region2ALBHostedZoneId<span style=color:#e6db74>\&#34;,\&#34;DNSName\&#34;:\&#34;</span>$Region2ALB<span style=color:#e6db74>\&#34;,\&#34;EvaluateTargetHealth\&#34;:false}}}]}&#34;</span>
</span></span></code></pre></div><p>Delete the Route 53 health checks.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws route53 delete-health-check --health-check-id $HealthCheckRegion1App1Id
</span></span><span style=display:flex><span>aws route53 delete-health-check --health-check-id $HealthCheckRegion1App2Id
</span></span><span style=display:flex><span>aws route53 delete-health-check --health-check-id $HealthCheckRegion2App1Id
</span></span><span style=display:flex><span>aws route53 delete-health-check --health-check-id $HealthCheckRegion2App2Id
</span></span></code></pre></div><p>Clean up any other resources that you created as part of the prerequisites if they are no longer needed.</p><h2 id=conclusion>Conclusion</h2><p>In this post, we demonstrated how to overcome a critical limitation in multi-Region, multi-tenant Amazon EKS architectures: the all-or-nothing failover behavior that impacts healthy applications when a single service fails. Implementing application-specific Amazon Route 53 health checks granted surgical precision in your failover strategy, redirecting only affected applications while maintaining optimal performance for healthy services.</p><p>This solution allows you to maintain the cost benefits of shared infrastructure while meeting diverse availability requirements. This eliminated unnecessary cross-Region latency for healthy applications during partial failures.</p><p>Ready to enhance your multi-Region resilience further? Consider these next steps:</p><p>Extend health checks beyond basic HTTP responses to monitor business-critical dependencies.
Integrate with Amazon Application Recovery Controller (ARC) for automated disaster recovery orchestration.
Start by identifying applications in your current setup that benefit most from independent failover behavior—particularly those with different SLA requirements or varying Regional user bases.</p><p>For more information, see the following references:</p><p>Amazon EKS Best Practices Guide
Best Practices for Amazon Route 53
Designing for high availability and resiliency in Amazon EKS applications</p><h2 id=about-the-authors>About the authors</h2><h3 id=dumlu-timuralp>Dumlu Timuralp</h3><p><img alt=Blog src=../../images/3-Blog/blog_1_5.png>
Dumlu Timuralp is a Senior Solutions Architect with AWS based in the United Kingdom. In this role he provides architecture guidance on cloud migration, application modernization and cloud native patterns. He loves working with users and meet their business needs with technology.</p><h3 id=pratik-mankad>Pratik Mankad</h3><p><img alt=Blog src=../../images/3-Blog/blog_1_6.jpeg>
Pratik Mankad is a Network Solutions Architect at AWS. He is passionate about network technologies and loves to innovate to help solve user problems. He enjoys architecting solutions and providing technical guidance to help users and partners achieve their technical and business objectives.</p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=../../3-blogstranslated/ title="Translated Blogs"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=../../3-blogstranslated/3.2-blog2/ title="Blog 2" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=../../js/clipboard.min.js?1765299477></script><script src=../../js/perfect-scrollbar.min.js?1765299477></script><script src=../../js/perfect-scrollbar.jquery.min.js?1765299477></script><script src=../../js/jquery.sticky.js?1765299477></script><script src=../../js/featherlight.min.js?1765299477></script><script src=../../js/highlight.pack.js?1765299477></script><script>hljs.initHighlightingOnLoad()</script><script src=../../js/modernizr.custom-3.6.0.js?1765299477></script><script src=../../js/learn.js?1765299477></script><script src=../../js/hugo-learn.js?1765299477></script><link href=../../mermaid/mermaid.css?1765299477 rel=stylesheet><script src=../../mermaid/mermaid.js?1765299477></script><script>mermaid.initialize({startOnLoad:!0})</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,(e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date),(i=t.createElement(n),a=t.getElementsByTagName(n)[0]),i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-158079754-2","auto"),ga("send","pageview")</script></body></html>