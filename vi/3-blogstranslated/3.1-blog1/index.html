<!doctype html><html lang=vi class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.134.3"><meta name=description content><meta name=author content="thienlh@thienlu.com"><link rel=icon href=../../../images/favicon.png type=image/png><title>Blog 1 :: Báo cáo thực tập</title>
<link href=../../../css/nucleus.css?1765299477 rel=stylesheet><link href=../../../css/fontawesome-all.min.css?1765299477 rel=stylesheet><link href=../../../css/hybrid.css?1765299477 rel=stylesheet><link href=../../../css/featherlight.min.css?1765299477 rel=stylesheet><link href=../../../css/perfect-scrollbar.min.css?1765299477 rel=stylesheet><link href=../../../css/auto-complete.css?1765299477 rel=stylesheet><link href=../../../css/atom-one-dark-reasonable.css?1765299477 rel=stylesheet><link href=../../../css/theme.css?1765299477 rel=stylesheet><link href=../../../css/hugo-theme.css?1765299477 rel=stylesheet><link href=../../../css/theme-workshop.css?1765299477 rel=stylesheet><script src=../../../js/jquery-3.3.1.min.js?1765299477></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=../../../vi/3-blogstranslated/3.1-blog1/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=../../../><svg id="Layer_1" data-name="Layer 1" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff}.cls-2{fill:#f90;fill-rule:evenodd}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09 10.85a4.7 4.7.0 00.19 1.48 7.73 7.73.0 00.54 1.19.77.77.0 01.12.38.64.64.0 01-.32.49l-1 .7a.83.83.0 01-.44.15.69.69.0 01-.49-.23 3.8 3.8.0 01-.6-.77q-.25-.42-.51-1a6.14 6.14.0 01-4.89 2.3 4.54 4.54.0 01-3.32-1.19 4.27 4.27.0 01-1.22-3.2 4.28 4.28.0 011.46-3.4A6.06 6.06.0 017.69 6.46a12.47 12.47.0 011.76.13q.92.13 1.91.36V5.73a3.65 3.65.0 00-.79-2.66A3.81 3.81.0 007.86 2.3a7.71 7.71.0 00-1.79.22 12.78 12.78.0 00-1.79.57 4.55 4.55.0 01-.58.22h-.26q-.35.0-.35-.52V2a1.09 1.09.0 01.12-.58 1.2 1.2.0 01.47-.35A10.88 10.88.0 015.77.32 10.19 10.19.0 018.36.0a6 6 0 014.35 1.35 5.49 5.49.0 011.38 4.09zM7.34 13.38a5.36 5.36.0 001.72-.31A3.63 3.63.0 0010.63 12 2.62 2.62.0 0011.19 11a5.63 5.63.0 00.16-1.44v-.7a14.35 14.35.0 00-1.53-.28 12.37 12.37.0 00-1.56-.1 3.84 3.84.0 00-2.47.67A2.34 2.34.0 005 11a2.35 2.35.0 00.61 1.76A2.4 2.4.0 007.34 13.38zm13.35 1.8a1 1 0 01-.64-.16 1.3 1.3.0 01-.35-.65L15.81 1.51a3 3 0 01-.15-.67.36.36.0 01.41-.41H17.7a1 1 0 01.65.16 1.4 1.4.0 01.33.65l2.79 11 2.59-11A1.17 1.17.0 0124.39.6a1.1 1.1.0 01.67-.16H26.4a1.1 1.1.0 01.67.16 1.17 1.17.0 01.32.65L30 12.39 32.88 1.25A1.39 1.39.0 0133.22.6a1 1 0 01.65-.16h1.54a.36.36.0 01.41.41 1.36 1.36.0 010 .26 3.64 3.64.0 01-.12.41l-4 12.86a1.3 1.3.0 01-.35.65 1 1 0 01-.64.16H29.25a1 1 0 01-.67-.17 1.26 1.26.0 01-.32-.67L25.67 3.64l-2.56 10.7a1.26 1.26.0 01-.32.67 1 1 0 01-.67.17zm21.36.44a11.28 11.28.0 01-2.56-.29 7.44 7.44.0 01-1.92-.67 1 1 0 01-.61-.93v-.84q0-.52.38-.52a.9.9.0 01.31.06l.42.17a8.77 8.77.0 001.83.58 9.78 9.78.0 002 .2 4.48 4.48.0 002.43-.55 1.76 1.76.0 00.86-1.57 1.61 1.61.0 00-.45-1.16A4.29 4.29.0 0043 9.22l-2.41-.76A5.15 5.15.0 0138 6.78a3.94 3.94.0 01-.83-2.41 3.7 3.7.0 01.45-1.85 4.47 4.47.0 011.19-1.37 5.27 5.27.0 011.7-.86A7.4 7.4.0 0142.6.0a8.87 8.87.0 011.12.07q.57.07 1.08.19t.95.26a4.27 4.27.0 01.7.29 1.59 1.59.0 01.49.41.94.94.0 01.15.55v.79q0 .52-.38.52a1.76 1.76.0 01-.64-.2 7.74 7.74.0 00-3.2-.64 4.37 4.37.0 00-2.21.47 1.6 1.6.0 00-.79 1.48 1.58 1.58.0 00.49 1.18 4.94 4.94.0 001.83.92L44.55 7a5.08 5.08.0 012.57 1.6A3.76 3.76.0 0147.9 11a4.21 4.21.0 01-.44 1.93 4.4 4.4.0 01-1.21 1.47 5.43 5.43.0 01-1.85.93A8.25 8.25.0 0142.05 15.62z"/><path class="cls-2" d="M45.19 23.81C39.72 27.85 31.78 30 25 30A36.64 36.64.0 01.22 20.57c-.51-.46-.06-1.09.56-.74A49.78 49.78.0 0025.53 26.4 49.23 49.23.0 0044.4 22.53C45.32 22.14 46.1 23.14 45.19 23.81z"/><path class="cls-2" d="M47.47 21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74 3.13-2.2 8.27-1.57 8.86-.83s-.16 5.89-3.09 8.35c-.45.38-.88.18-.68-.32C46.69 25.8 48.17 22.11 47.47 21.21z"/></svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=../../../js/lunr.min.js?1765299477></script><script type=text/javascript src=../../../js/auto-complete.js?1765299477></script><script type=text/javascript>var baseurl="https://thienluhoan.github.io/workshop-template//vi"</script><script type=text/javascript src=../../../js/search.js?1765299477></script></div><div class=highlightable><ul class=topics><li data-nav-id=/vi/1-worklog/ title=Worklog class=dd-item><a href=../../../vi/1-worklog/><b>1. </b>Worklog
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/1-worklog/1.1-week1/ title="Worklog Tuần 1" class=dd-item><a href=../../../vi/1-worklog/1.1-week1/><b>1.1. </b>Worklog Tuần 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.2-week2/ title="Worklog Tuần 2" class=dd-item><a href=../../../vi/1-worklog/1.2-week2/><b>1.2. </b>Worklog Tuần 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.3-week3/ title="Worklog Tuần 3" class=dd-item><a href=../../../vi/1-worklog/1.3-week3/><b>1.3. </b>Worklog Tuần 3
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.4-week4/ title="Worklog Tuần 4" class=dd-item><a href=../../../vi/1-worklog/1.4-week4/><b>1.4. </b>Worklog Tuần 4
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.5-week5/ title="Worklog Tuần 5" class=dd-item><a href=../../../vi/1-worklog/1.5-week5/><b>1.5. </b>Worklog Tuần 5
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.6-week6/ title="Worklog Tuần 6" class=dd-item><a href=../../../vi/1-worklog/1.6-week6/><b>1.6. </b>Worklog Tuần 6
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.7-week7/ title="Worklog Tuần 7" class=dd-item><a href=../../../vi/1-worklog/1.7-week7/><b>1.7. </b>Worklog Tuần 7
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.8-week8/ title="Worklog Tuần 8" class=dd-item><a href=../../../vi/1-worklog/1.8-week8/><b>1.8. </b>Worklog Tuần 8
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.9-week9/ title="Worklog Tuần 9" class=dd-item><a href=../../../vi/1-worklog/1.9-week9/><b>1.9. </b>Worklog Tuần 9
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.10-week10/ title="Worklog Tuần 10" class=dd-item><a href=../../../vi/1-worklog/1.10-week10/><b>1.10. </b>Worklog Tuần 10
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.11-week11/ title="Worklog Tuần 11" class=dd-item><a href=../../../vi/1-worklog/1.11-week11/><b>1.11. </b>Worklog Tuần 11
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.12-week12/ title="Worklog Tuần 12" class=dd-item><a href=../../../vi/1-worklog/1.12-week12/><b>1.12. </b>Worklog Tuần 12
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/2-proposal/ title="Đề Xuất" class=dd-item><a href=../../../vi/2-proposal/><b>2. </b>Đề Xuất
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/ title="Các Blog đã Dịch" class="dd-item
parent"><a href=../../../vi/3-blogstranslated/><b>3. </b>Các Blog đã Dịch
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/3-blogstranslated/3.1-blog1/ title="Blog 1" class="dd-item
active"><a href=../../../vi/3-blogstranslated/3.1-blog1/><b>3.1. </b>Blog 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/3.2-blog2/ title="Blog 2" class=dd-item><a href=../../../vi/3-blogstranslated/3.2-blog2/><b>3.2. </b>Blog 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/3.3-blog3/ title="Blog 3" class=dd-item><a href=../../../vi/3-blogstranslated/3.3-blog3/><b>3.3. </b>Blog 3
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/5-workshop/ title=Workshop class=dd-item><a href=../../../vi/5-workshop/><b>5. </b>Workshop
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/5-workshop/5.1-workshop-overview/ title="Tổng quan Workshop" class=dd-item><a href=../../../vi/5-workshop/5.1-workshop-overview/><b>5.1. </b>Tổng quan Workshop
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.2-prerequisite/ title="Yêu cầu tiên quyết" class=dd-item><a href=../../../vi/5-workshop/5.2-prerequisite/><b>5.2. </b>Yêu cầu tiên quyết
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.3-architecture/ title="Kiến trúc Dự án" class=dd-item><a href=../../../vi/5-workshop/5.3-architecture/><b>5.3. </b>Kiến trúc Dự án
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.4-setup-aws/ title="Thiết lập Môi trường AWS" class=dd-item><a href=../../../vi/5-workshop/5.4-setup-aws/><b>5.4. </b>Thiết lập Môi trường AWS
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.5-database-setup/ title="Thiết lập Database (DynamoDB)" class=dd-item><a href=../../../vi/5-workshop/5.5-database-setup/><b>5.5. </b>Thiết lập Database (DynamoDB)
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.6-authentication/ title="Dịch vụ Xác thực" class=dd-item><a href=../../../vi/5-workshop/5.6-authentication/><b>5.6. </b>Dịch vụ Xác thực
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.7-backend-services/ title="Dịch vụ Backend" class=dd-item><a href=../../../vi/5-workshop/5.7-backend-services/><b>5.7. </b>Dịch vụ Backend
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.8-frontend/ title="Phát triển Frontend" class=dd-item><a href=../../../vi/5-workshop/5.8-frontend/><b>5.8. </b>Phát triển Frontend
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.9-deployment/ title="Triển khai" class=dd-item><a href=../../../vi/5-workshop/5.9-deployment/><b>5.9. </b>Triển khai
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.10-testing/ title="Kiểm tra & Giám sát" class=dd-item><a href=../../../vi/5-workshop/5.10-testing/><b>5.10. </b>Kiểm tra & Giám sát
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.11-cleanup/ title="Dọn dẹp" class=dd-item><a href=../../../vi/5-workshop/5.11-cleanup/><b>5.11. </b>Dọn dẹp
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/6-self-evaluation/ title="Tự Đánh giá" class=dd-item><a href=../../../vi/6-self-evaluation/><b>6. </b>Tự Đánh giá
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/7-feedback/ title="Chia sẻ, đóng góp ý kiến" class=dd-item><a href=../../../vi/7-feedback/><b>7. </b>Chia sẻ, đóng góp ý kiến
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/4-eventparticipated/ title class=dd-item><a href=../../../vi/4-eventparticipated/><i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/4-eventparticipated/4.1-event1/ title="AWS First Cloud Journey Community Day" class=dd-item><a href=../../../vi/4-eventparticipated/4.1-event1/><b>4.1. </b>AWS First Cloud Journey Community Day
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/4-eventparticipated/4.2-event2/ title="Kick-off AWS First Cloud Journey Workforce OJT FALL 2025" class=dd-item><a href=../../../vi/4-eventparticipated/4.2-event2/><b>4.2. </b>Kick-off AWS First Cloud Journey Workforce OJT FALL 2025
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/4-eventparticipated/4.3-event3/ title="Workshop: Data Science on AWS" class=dd-item><a href=../../../vi/4-eventparticipated/4.3-event3/><b>4.3. </b>Workshop: Data Science on AWS
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/4-eventparticipated/4.4-event4/ title="AWS AI/ML & GenAI Workshop" class=dd-item><a href=../../../vi/4-eventparticipated/4.4-event4/><b>4.4. </b>AWS AI/ML & GenAI Workshop
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/4-eventparticipated/4.5-event5/ title="AWS DevOps & Modern Operations" class=dd-item><a href=../../../vi/4-eventparticipated/4.5-event5/><b>4.5. </b>AWS DevOps & Modern Operations
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/4-eventparticipated/4.6-event6/ title="AWS Security Specialty Workshop" class=dd-item><a href=../../../vi/4-eventparticipated/4.6-event6/><b>4.6. </b>AWS Security Specialty Workshop
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/4-eventparticipated/4.7-event7/ title="CloudThinker: Agentic AI & Orchestration on AWS" class=dd-item><a href=../../../vi/4-eventparticipated/4.7-event7/><b>4.7. </b>CloudThinker: Agentic AI & Orchestration on AWS
<i class="fas fa-check read-icon"></i></a></li></ul></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://www.facebook.com/groups/awsstudygroupfcj/><i class='fab fa-facebook'></i> AWS Study Group</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value"><option id=en value=https://thienluhoan.github.io/workshop-template/3-blogstranslated/3.1-blog1/>English</option><option id=vi value=https://thienluhoan.github.io/workshop-template/vi/3-blogstranslated/3.1-blog1/ selected>Tiếng Việt</option></select><svg id="Capa_1" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><polygon points="0,63.75 127.5,191.25 255,63.75"/></g></g></svg></div></a></li><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></section><section id=footer><left><b>Workshop</b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title=Migrate alt="web counter" border=0></a><br><b><a href=https://cloudjourney.awsstudygroup.com/>Cloud Journey</a></b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" alt="web counter" border=0>
</left><left><br><br><b>Last Updated</b><br><i><span id=lastUpdated style=color:orange></span>
</i><script>const today=new Date,formattedDate=today.toLocaleDateString("en-GB");document.getElementById("lastUpdated").textContent=formattedDate</script></left><left><br><br><b>Team</b><br><i><a href=https://www.facebook.com/groups/660548818043427 style=color:orange>First Cloud Journey</a><br></i></left><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i>
</a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=../../../vi/>Báo cáo thực tập</a> > <a href=../../../vi/3-blogstranslated/>Các Blog đã Dịch</a> > Blog 1</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#kiến-trúc-điển-hình>Kiến trúc điển hình</a></li><li><a href=#tổng-quan-giải-pháp>Tổng quan giải pháp</a></li><li><a href=#yêu-cầu-chuẩn-bị>Yêu cầu chuẩn bị</a></li><li><a href=#walkthrough>Walkthrough</a><ul><li><a href=#cấu-hình-biến-môi-trường>Cấu hình biến môi trường</a></li><li><a href=#tạo-cụm-eks-tại-region-1-và-region-2>Tạo cụm EKS tại Region 1 và Region 2</a></li><li><a href=#tạo-cấu-hình-ingressclass>Tạo cấu hình IngressClass</a></li></ul></li><li><a href=#triển-khai-app1-và-app2-trên-hai-cụm-eks>Triển khai app1 và app2 trên hai cụm EKS</a></li><li><a href=#cấu-hình-route-53-health-check-cho-app1-và-app2>Cấu hình Route 53 Health Check cho app1 và app2</a></li><li><a href=#cấu-hình-alias-record-trong-route-53-cho-app1-và-app2>Cấu hình alias record trong Route 53 cho app1 và app2</a></li><li><a href=#kiểm-tra-phản-ứng-của-hệ-thống-khi-một-ứng-dụng-gặp-sự-cố>Kiểm tra phản ứng của hệ thống khi một ứng dụng gặp sự cố</a></li><li><a href=#những-điều-cần-biết>Những điều cần biết</a></li><li><a href=#dọn-dẹp-tài-nguyên>Dọn dẹp tài nguyên</a></li><li><a href=#kết-luận>Kết luận</a></li><li><a href=#giới-thiệu-về-tác-giả>Giới thiệu về tác giả</a><ul><li><a href=#dumlu-timuralp>Dumlu Timuralp</a></li><li><a href=#pratik-mankad>Pratik Mankad</a></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Blog 1</h1><h1 id=triển-khai-cơ-chế-failover-chi-tiết-trong-môi-trường-amazon-eks-multi-region>Triển khai cơ chế failover chi tiết trong môi trường Amazon EKS multi-Region</h1><p>bới Dumlu Timuralp và Pratik R. Mankad | vào ngày 18 tháng 9 năm 2025 | tại Amazon Elastic Kubernetes Service, Amazon Route 53, Technical How-to | Permalink | Chia Sẻ</p><p>Các doanh nghiệp thuộc nhiều ngành khác nhau vận hành hàng chục triệu cụm Amazon Elastic Kubernetes Service (Amazon EKS) mỗi năm, phục vụ nhiều trường hợp sử dụng khác nhau như ứng dụng web/di động, xử lý dữ liệu, machine learning (ML), generative AI, gaming và Internet of Things (IoT). Khi các tổ chức ngày càng áp dụng mô hình nền tảng multi-tenant, nơi nhiều nhóm ứng dụng cùng chia sẻ một cụm EKS, họ cần khả năng kiểm soát chi tiết hơn về tính sẵn sàng của ứng dụng trong các kiến trúc multi-Region, đặc biệt để phục vụ người dùng toàn cầu và đáp ứng các yêu cầu tuân thủ nghiêm ngặt.</p><p>Mặc dù mô hình multi-tenant giúp tối ưu hóa việc sử dụng tài nguyên và giảm chi phí vận hành, nhưng nó cũng đặt ra thách thức khi các ứng dụng cần mục tiêu riêng biệt về Recovery Point Objective (RPO) và Recovery Time Objective (RTO) trên nhiều vùng AWS. Các phương pháp truyền thống buộc phải áp dụng chính sách failover đồng nhất cho mọi ứng dụng, khiến chỉ cần một ứng dụng gặp sự cố là phải hy sinh giữa hiệu quả vận hành và độ bền vững riêng của từng ứng dụng.</p><p>Trong bài viết này, chúng tôi sẽ minh họa cách cấu hình Amazon Route 53 để cho phép hành vi failover riêng biệt cho từng ứng dụng trong môi trường multi-tenant Amazon EKS đa vùng. Giải pháp này giúp bạn duy trì lợi ích chi phí của hạ tầng dùng chung mà vẫn đáp ứng các yêu cầu sẵn sàng khác nhau của từng ứng dụng.</p><h2 id=kiến-trúc-điển-hình>Kiến trúc điển hình</h2><p>Trước khi đi vào chi tiết giải pháp, chúng ta hãy cùng xem cách mà một kiến trúc Amazon EKS multi-Region, multi-tenant thường được cấu trúc, và các thành phần chính cho phép Regional traffic routing. Hình 1 mô tả các thành phần chính sau:
Route 53
Traffic routing đến Application Load Balancer (ALB) tại từng vùng tương ứng.
Đảm bảo tính sẵn sàng cao và khả năng phục hồi khi xảy ra sự cố.</p><p>AWS Load Balancer Controller
Cho biết các ứng dụng đang chạy trên cụm EKS thông qua ALB.
Sử dụng IP target type để đăng ký các Pod ứng dụng vào ALB.</p><p>Cấu hình Route 53:
Regional Routing:
Mỗi vùng AWS sử dụng một Route 53 alias record để route traffic đến ALB tương ứng.
Ví dụ: app1.example.com trỏ đến ALB ở Region 1
Ví dụ: app2.example.com trỏ đến ALB ở Region 2</p><p>Giám sát sức khỏe:
Thuộc tính “Evaluate target health” trong alias record:
Liên tục giám sát tình trạng của ALB
Tự động loại bỏ các ALB bất ổn định khỏi phản hồi DNS</p><p>Request routing:
Cung cấp các chính sách định tuyến cho kiến trúc active-active</p><p><img alt=Blog src=../../../images/3-Blog/blog_1_0.jpg></p><p>Hình 1: Kiến trúc nền tảng Amazon EKS multi-Region, multi-tenant</p><p>Vấn đề “all-or-nothing health check”</p><p>Thuộc tính Evaluate target health trong alias record của Route 53 liên tục giám sát tình trạng của ALB được chỉ định. Một ALB chỉ được xem là ổn định nếu tất cả các target group được cấu hình đều có ít nhất một target khỏe mạnh.
Nếu bất kỳ target group nào trở nên bất ổn định, Route 53 sẽ đánh dấu toàn bộ ALB là bất ổn định và loại nó khỏi phản hồi DNS, khiến người dùng bị chuyển hướng đến các vùng còn lại.</p><p>Hiện tượng này tạo ra hiệu ứng “lỗi dây chuyền” trong môi trường multi-tenant:
Khi một ứng dụng gặp lỗi → Route 53 đánh dấu toàn bộ ALB là bất ổn định.
Tất cả lưu lượng sẽ chuyển sang vùng AWS khác, kể cả đối với ứng dụng ổn định.
Ứng dụng đang hoạt động tốt bị ảnh hưởng bởi sự tăng cao không cần thiết của latency.</p><p>Ví dụ:
app1.example.com lỗi ở Region 1.
app2.example.com vẫn hoạt động tốt ở Region 1.
Route 53 chuyển toàn bộ lưu lượng sang Region 2.
Người dùng của app2 chịu tăng latency dù ứng dụng không lỗi.</p><p>Hành vi này buộc người dùng phải chọn giữa hai lựa chọn không tối ưu:
Chấp nhận toàn bộ vùng bị lỗi khi bất kỳ microservice nào hỏng.
Triển khai ALB riêng cho từng microservice → tăng độ phức tạp và chi phí.</p><p>Các phần tiếp theo trình bày một giải pháp khắc phục giúp đạt được mô hình triển khai đa vùng có độ bền cao hơn.</p><h2 id=tổng-quan-giải-pháp>Tổng quan giải pháp</h2><p>Để khắc phục vấn đề này, chúng tôi đề xuất giải pháp cho phép kiểm soát failover chi tiết ở cấp độ ứng dụng.
Hình 2 minh họa kiến trúc của giải pháp. Giải pháp gồm hai cấu hình chính:</p><ol><li><p>Health check riêng cho từng ứng dụng
Cấu hình Route 53 health check chuyên biệt cho từng ứng dụng ở mỗi vùng AWS.
Gán từng health check cho alias record tương ứng.
Thiết lập Evaluate Target Health = No trong alias record.</p></li><li><p>Kiểm soát failover chi tiết
Route 53 giám sát sức khỏe của từng ứng dụng độc lập.
Khi xảy ra lỗi, chỉ ứng dụng bị ảnh hưởng mới bị chuyển hướng lưu lượng.
Ứng dụng khỏe mạnh vẫn tiếp tục phục vụ tại vùng ban đầu.</p></li></ol><p><img alt=Blog src=../../../images/3-Blog/blog_1_1.jpg></p><p>Hình 2: Kiến trúc giải pháp
Lợi ích chính của kiến trúc:
Kiểm soát và giám sát nâng cao:
Giám sát chi tiết ở cấp độ ứng dụng (target group).
Loại bỏ giới hạn chỉ giám sát ở cấp ALB.</p><p>Quản lý failover thông minh:
Failover chọn lọc cho từng ứng dụng riêng biệt.
Bảo vệ ứng dụng ổn định khỏi bị ảnh hưởng bởi sự cố của ứng dụng khác.
Duy trì định tuyến tối ưu cho dịch vụ không bị lỗi.</p><p>Tổ chức có thể:
Duy trì lợi ích chi phí của hạ tầng dùng chung.
Đạt được độ bền riêng cho từng ứng dụng.
Đáp ứng yêu cầu sẵn sàng khác nhau.
Tránh định tuyến chéo vùng không cần thiết.</p><h2 id=yêu-cầu-chuẩn-bị>Yêu cầu chuẩn bị</h2><p>Bạn cần có:
Tài khoản AWS.
Một public hosted zone trong Route 53 (hoặc đăng ký miền mới / sử dụng miền hiện có).
AWS Command Line Interface (AWS CLI)
eksctl
kubectl
kubectx (tùy chọn)
AWS CloudShell (tùy chọn).</p><h2 id=walkthrough>Walkthrough</h2><p>Cách bước sau đây sẽ hướng dẫn bạn về giải pháp này.</p><h3 id=cấu-hình-biến-môi-trường>Cấu hình biến môi trường</h3><p>Thay thế các giá trị trong ví dụ bằng thông tin của bạn và tạo biến môi trường:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export ACCOUNT_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>aws sts get-caller-identity --output text --query Account<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>export Region1<span style=color:#f92672>=</span>eu-west-1 
</span></span><span style=display:flex><span>export Region2<span style=color:#f92672>=</span>eu-central-1
</span></span><span style=display:flex><span>export ALBName<span style=color:#f92672>=</span>demoalb
</span></span><span style=display:flex><span>export Region1ClusterName<span style=color:#f92672>=</span>cluster1
</span></span><span style=display:flex><span>export Region2ClusterName<span style=color:#f92672>=</span>cluster2
</span></span><span style=display:flex><span>export app1hostname<span style=color:#f92672>=</span>app1.example.com
</span></span><span style=display:flex><span>export app2hostname<span style=color:#f92672>=</span>app2.example.com
</span></span><span style=display:flex><span>export HostedZoneName<span style=color:#f92672>=</span>example.com
</span></span><span style=display:flex><span>export HostedZoneId<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>aws route53 list-hosted-zones-by-name --dns-name $HostedZoneName --query <span style=color:#e6db74>&#39;HostedZones[0].Id&#39;</span> --output text | cut -d<span style=color:#e6db74>&#39;/&#39;</span> -f3<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><h3 id=tạo-cụm-eks-tại-region-1-và-region-2>Tạo cụm EKS tại Region 1 và Region 2</h3><ol><li>Tạo cụm EKS tại Region 1</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>eksctl create cluster --name<span style=color:#f92672>=</span>$Region1ClusterName --enable-auto-mode --region<span style=color:#f92672>=</span>$Region1
</span></span></code></pre></div><ol start=2><li>Chờ trạng thái cụm chuyển sang Active (khoảng 12 phút).</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws eks describe-cluster --name $Region1ClusterName --region $Region1 --output json --query <span style=color:#e6db74>&#39;cluster.status&#39;</span>
</span></span></code></pre></div><ol start=3><li>Lặp lại tương tự cho Region 2:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>eksctl create cluster --name<span style=color:#f92672>=</span>$Region2ClusterName --enable-auto-mode --region<span style=color:#f92672>=</span>$Region2
</span></span></code></pre></div><ol start=4><li>Chờ trạng thái cụm chuyển sang Active (khoảng 12 phút).</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws eks describe-cluster --name $Region2ClusterName --region $Region2 --output json --query <span style=color:#e6db74>&#39;cluster.status&#39;</span>
</span></span></code></pre></div><ol start=5><li>Sau khi tạo xong, eksctl sẽ tự động cập nhật file kubeconfig. Sử dụng kubectl để liệt kê từng cụm. Sử dụng kubectx (hoặc tự tay đổi) để chuyển giữa hai cụm.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get nodes
</span></span></code></pre></div><h3 id=tạo-cấu-hình-ingressclass>Tạo cấu hình IngressClass</h3><ol><li>Chạy câu lệnh này để tạo IngressClassParams và IngressClass tại cụm của Region 1</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -s https://raw.githubusercontent.com/aws-samples/multi-region-ingress/refs/heads/main/ingressclassconfiguration.yaml | kubectl apply -f -
</span></span></code></pre></div><ol start=2><li>Xác nhận rằng tài nguyên đã được tạo</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get ingressclass,ingressclassparams
</span></span></code></pre></div><ol start=3><li>Thực hiện tương tự trên cụm ở Region 2.</li></ol><h2 id=triển-khai-app1-và-app2-trên-hai-cụm-eks>Triển khai app1 và app2 trên hai cụm EKS</h2><ol><li>Chúng ta sẽ sử dụng “manifest” để triển khai ứng dụng trên cụm tại Region 1. “Manifest” sẽ tạo:
Triển khai với duy nhất 1 bản sao cho từng ứng dụng
Dịch vụ cho từng sự triển khai
“Ingress” để forward http requests lên dịch vụ</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -s https://github.com/aws-samples/multi-region-ingress/blob/main/multitenant.yaml | envsubst | kubectl apply -f -
</span></span></code></pre></div><ol start=2><li>Xác nhận rằng tài nguyên đã được tạo. Bạn sẽ thấy được 2 ứng dụng đã được triển khai, 2 dịch vụ, và 1 “ingress” trong output. Điều này cho biết rằng pod hiện đang chạy.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get all,ingress
</span></span></code></pre></div><ol start=3><li>Thực hiện tương tự trên cụm ở Region 2.
Ứng dụng mẫu hiển thị trang HTML với tên ứng dụng, tên Pod, AWS Region và AWS Availability Zone tương ứng. Cái này sẽ được làm mẫu ở hình 3 và hình 4. Kiểm tra kích hoạt sau khi xác định được Route 53 tại bước tiếp theo</li></ol><p><img alt=Blog src=../../../images/3-Blog/blog_1_2.jpg></p><p>Hình 3: Giao diện App1</p><p><img alt=Blog src=../../../images/3-Blog/blog_1_3.jpg></p><p>Hình 4: Giao diện App2</p><h2 id=cấu-hình-route-53-health-check-cho-app1-và-app2>Cấu hình Route 53 Health Check cho app1 và app2</h2><ol><li>Định nghĩa biến cho ALB:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export Region1ALB<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>aws elbv2 describe-load-balancers --region $Region1 --query <span style=color:#e6db74>&#34;LoadBalancers[?contains(LoadBalancerName, &#39;</span>$ALBName<span style=color:#e6db74>&#39;)].DNSName | [0]&#34;</span> --output text<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>export Region2ALB<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>aws elbv2 describe-load-balancers --region $Region2 --query <span style=color:#e6db74>&#34;LoadBalancers[?contains(LoadBalancerName, &#39;</span>$ALBName<span style=color:#e6db74>&#39;)].DNSName | [0]&#34;</span> --output text<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><ol start=2><li>Tạo health check cho app1 ở từng vùng:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws route53 create-health-check --caller-reference <span style=color:#e6db74>&#34;Region1App1-</span><span style=color:#66d9ef>$(</span>date +%s<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--health-check-config <span style=color:#e6db74>&#34;{\&#34;Port\&#34;:80,\&#34;Type\&#34;:\&#34;HTTP\&#34;,\&#34;ResourcePath\&#34;:\&#34;/app1health\&#34;,\&#34;FullyQualifiedDomainName\&#34;:\&#34;</span>$Region1ALB<span style=color:#e6db74>\&#34;,\&#34;RequestInterval\&#34;:30,\&#34;FailureThreshold\&#34;:3,\&#34;MeasureLatency\&#34;:true,\&#34;Inverted\&#34;:false,\&#34;Disabled\&#34;:false,\&#34;EnableSNI\&#34;:false}&#34;</span>
</span></span><span style=display:flex><span>aws route53 create-health-check --caller-reference <span style=color:#e6db74>&#34;Region2App1-</span><span style=color:#66d9ef>$(</span>date +%s<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--health-check-config <span style=color:#e6db74>&#34;{\&#34;Port\&#34;:80,\&#34;Type\&#34;:\&#34;HTTP\&#34;,\&#34;ResourcePath\&#34;:\&#34;/app1health\&#34;,\&#34;FullyQualifiedDomainName\&#34;:\&#34;</span>$Region2ALB<span style=color:#e6db74>\&#34;,\&#34;RequestInterval\&#34;:30,\&#34;FailureThreshold\&#34;:3,\&#34;MeasureLatency\&#34;:true,\&#34;Inverted\&#34;:false,\&#34;Disabled\&#34;:false,\&#34;EnableSNI\&#34;:false}&#34;</span>
</span></span></code></pre></div><ol start=3><li>Tạo health check cho app 2 ở từng vùng.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws route53 create-health-check --caller-reference <span style=color:#e6db74>&#34;Region1App1-</span><span style=color:#66d9ef>$(</span>date +%s<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--health-check-config <span style=color:#e6db74>&#34;{\&#34;Port\&#34;:80,\&#34;Type\&#34;:\&#34;HTTP\&#34;,\&#34;ResourcePath\&#34;:\&#34;/app2health\&#34;,\&#34;FullyQualifiedDomainName\&#34;:\&#34;</span>$Region1ALB<span style=color:#e6db74>\&#34;,\&#34;RequestInterval\&#34;:30,\&#34;FailureThreshold\&#34;:3,\&#34;MeasureLatency\&#34;:true,\&#34;Inverted\&#34;:false,\&#34;Disabled\&#34;:false,\&#34;EnableSNI\&#34;:false}&#34;</span>
</span></span><span style=display:flex><span>aws route53 create-health-check --caller-reference <span style=color:#e6db74>&#34;Region2App1-</span><span style=color:#66d9ef>$(</span>date +%s<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--health-check-config <span style=color:#e6db74>&#34;{\&#34;Port\&#34;:80,\&#34;Type\&#34;:\&#34;HTTP\&#34;,\&#34;ResourcePath\&#34;:\&#34;/app2health\&#34;,\&#34;FullyQualifiedDomainName\&#34;:\&#34;</span>$Region2ALB<span style=color:#e6db74>\&#34;,\&#34;RequestInterval\&#34;:30,\&#34;FailureThreshold\&#34;:3,\&#34;MeasureLatency\&#34;:true,\&#34;Inverted\&#34;:false,\&#34;Disabled\&#34;:false,\&#34;EnableSNI\&#34;:false}&#34;</span>
</span></span></code></pre></div><h2 id=cấu-hình-alias-record-trong-route-53-cho-app1-và-app2>Cấu hình alias record trong Route 53 cho app1 và app2</h2><ol><li>Định nghĩa các biến môi trường cho các health check đã tạo trước đó</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export HealthCheckRegion1App1Id<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>aws route53 list-health-checks <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --query <span style=color:#e6db74>&#34;HealthChecks[?HealthCheckConfig.FullyQualifiedDomainName==&#39;</span>$Region1ALB<span style=color:#e6db74>&#39; &amp;&amp; HealthCheckConfig.ResourcePath==&#39;/app1health&#39;] | [0].Id&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --output text<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>export HealthCheckRegion1App2Id<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>aws route53 list-health-checks <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --query <span style=color:#e6db74>&#34;HealthChecks[?HealthCheckConfig.FullyQualifiedDomainName==&#39;</span>$Region1ALB<span style=color:#e6db74>&#39; &amp;&amp; HealthCheckConfig.ResourcePath==&#39;/app2health&#39;] | [0].Id&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --output text<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>export HealthCheckRegion2App1Id<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>aws route53 list-health-checks <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --query <span style=color:#e6db74>&#34;HealthChecks[?HealthCheckConfig.FullyQualifiedDomainName==&#39;</span>$Region2ALB<span style=color:#e6db74>&#39; &amp;&amp; HealthCheckConfig.ResourcePath==&#39;/app1health&#39;] | [0].Id&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --output text<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>export HealthCheckRegion2App2Id<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>aws route53 list-health-checks <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --query <span style=color:#e6db74>&#34;HealthChecks[?HealthCheckConfig.FullyQualifiedDomainName==&#39;</span>$Region2ALB<span style=color:#e6db74>&#39; &amp;&amp; HealthCheckConfig.ResourcePath==&#39;/app2health&#39;] | [0].Id&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --output text<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><ol start=2><li>Định nghĩa các biến môi trường cho CanonicalHostedZoneId của ALB. Chúng ta cần sử dụng các biến này khi tạo alias record ở các bước tiếp theo.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export Region1ALBHostedZoneId<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>aws elbv2 describe-load-balancers --region $Region1 --query <span style=color:#e6db74>&#34;LoadBalancers[?DNSName==&#39;</span>$Region1ALB<span style=color:#e6db74>&#39;].CanonicalHostedZoneId&#34;</span> --output text<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>export Region2ALBHostedZoneId<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>aws elbv2 describe-load-balancers --region $Region2 --query <span style=color:#e6db74>&#34;LoadBalancers[?DNSName==&#39;</span>$Region2ALB<span style=color:#e6db74>&#39;].CanonicalHostedZoneId&#34;</span> --output text<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><ol start=3><li>Tạo alias record cho app1. Trong ví dụ này, chúng ta sử dụng latency-based routing policy cho từng record.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws route53 change-resource-record-sets --hosted-zone-id $HostedZoneId <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --change-batch <span style=color:#e6db74>&#34;{\&#34;Changes\&#34;:[{\&#34;Action\&#34;:\&#34;CREATE\&#34;,\&#34;ResourceRecordSet\&#34;:{\&#34;Name\&#34;:\&#34;</span>$app1hostname<span style=color:#e6db74>\&#34;,\&#34;Type\&#34;:\&#34;A\&#34;,\&#34;SetIdentifier\&#34;:\&#34;</span>$Region1<span style=color:#e6db74>\&#34;,\&#34;Region\&#34;:\&#34;</span>$Region1<span style=color:#e6db74>\&#34;,\&#34;HealthCheckId\&#34;:\&#34;</span>$HealthCheckRegion1App1Id<span style=color:#e6db74>\&#34;,\&#34;AliasTarget\&#34;:{\&#34;HostedZoneId\&#34;:\&#34;</span>$Region1ALBHostedZoneId<span style=color:#e6db74>\&#34;,\&#34;DNSName\&#34;:\&#34;</span>$Region1ALB<span style=color:#e6db74>\&#34;,\&#34;EvaluateTargetHealth\&#34;:false}}}]}&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>aws route53 change-resource-record-sets --hosted-zone-id $HostedZoneId <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --change-batch <span style=color:#e6db74>&#34;{\&#34;Changes\&#34;:[{\&#34;Action\&#34;:\&#34;CREATE\&#34;,\&#34;ResourceRecordSet\&#34;:{\&#34;Name\&#34;:\&#34;</span>$app1hostname<span style=color:#e6db74>\&#34;,\&#34;Type\&#34;:\&#34;A\&#34;,\&#34;SetIdentifier\&#34;:\&#34;</span>$Region2<span style=color:#e6db74>\&#34;,\&#34;Region\&#34;:\&#34;</span>$Region2<span style=color:#e6db74>\&#34;,\&#34;HealthCheckId\&#34;:\&#34;</span>$HealthCheckRegion2App1Id<span style=color:#e6db74>\&#34;,\&#34;AliasTarget\&#34;:{\&#34;HostedZoneId\&#34;:\&#34;</span>$Region2ALBHostedZoneId<span style=color:#e6db74>\&#34;,\&#34;DNSName\&#34;:\&#34;</span>$Region2ALB<span style=color:#e6db74>\&#34;,\&#34;EvaluateTargetHealth\&#34;:false}}}]}&#34;</span>
</span></span></code></pre></div><ol start=4><li>Xác minh rằng các alias record cho app1 đã được tạo thành công trong Route 53 hosted zone</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws route53 list-resource-record-sets --hosted-zone-id $HostedZoneId --query <span style=color:#e6db74>&#34;ResourceRecordSets[?Name==&#39;</span>$app1hostname<span style=color:#e6db74>.&#39;]&#34;</span>
</span></span></code></pre></div><ol start=5><li>Tạo alias record cho app2. Trong ví dụ này, chúng ta cũng sử dụng latency-based routing policy cho từng record.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws route53 change-resource-record-sets --hosted-zone-id $HostedZoneId <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --change-batch <span style=color:#e6db74>&#34;{\&#34;Changes\&#34;:[{\&#34;Action\&#34;:\&#34;CREATE\&#34;,\&#34;ResourceRecordSet\&#34;:{\&#34;Name\&#34;:\&#34;</span>$app2hostname<span style=color:#e6db74>\&#34;,\&#34;Type\&#34;:\&#34;A\&#34;,\&#34;SetIdentifier\&#34;:\&#34;</span>$Region1<span style=color:#e6db74>\&#34;,\&#34;Region\&#34;:\&#34;</span>$Region1<span style=color:#e6db74>\&#34;,\&#34;HealthCheckId\&#34;:\&#34;</span>$HealthCheckRegion1App2Id<span style=color:#e6db74>\&#34;,\&#34;AliasTarget\&#34;:{\&#34;HostedZoneId\&#34;:\&#34;</span>$Region1ALBHostedZoneId<span style=color:#e6db74>\&#34;,\&#34;DNSName\&#34;:\&#34;</span>$Region1ALB<span style=color:#e6db74>\&#34;,\&#34;EvaluateTargetHealth\&#34;:false}}}]}&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>aws route53 change-resource-record-sets --hosted-zone-id $HostedZoneId <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --change-batch <span style=color:#e6db74>&#34;{\&#34;Changes\&#34;:[{\&#34;Action\&#34;:\&#34;CREATE\&#34;,\&#34;ResourceRecordSet\&#34;:{\&#34;Name\&#34;:\&#34;</span>$app2hostname<span style=color:#e6db74>\&#34;,\&#34;Type\&#34;:\&#34;A\&#34;,\&#34;SetIdentifier\&#34;:\&#34;</span>$Region2<span style=color:#e6db74>\&#34;,\&#34;Region\&#34;:\&#34;</span>$Region2<span style=color:#e6db74>\&#34;,\&#34;HealthCheckId\&#34;:\&#34;</span>$HealthCheckRegion2App2Id<span style=color:#e6db74>\&#34;,\&#34;AliasTarget\&#34;:{\&#34;HostedZoneId\&#34;:\&#34;</span>$Region2ALBHostedZoneId<span style=color:#e6db74>\&#34;,\&#34;DNSName\&#34;:\&#34;</span>$Region2ALB<span style=color:#e6db74>\&#34;,\&#34;EvaluateTargetHealth\&#34;:false}}}]}&#34;</span>
</span></span></code></pre></div><ol start=6><li>Xác minh rằng các alias record cho app2 đã được tạo thành công trong Route 53 hosted zone</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws route53 list-resource-record-sets --hosted-zone-id $HostedZoneId --query <span style=color:#e6db74>&#34;ResourceRecordSets[?Name==&#39;</span>$app2hostname<span style=color:#e6db74>.&#39;]&#34;</span>
</span></span></code></pre></div><p>Lưu ý: Việc cập nhật DNS có thể mất một khoảng thời gian để lan truyền trên toàn hệ thống.
Vì vậy, bạn có thể chưa truy cập được ngay vào các tên miền ứng dụng (app1.example.com và app2.example.com) sau khi tạo xong các bản ghi.</p><h2 id=kiểm-tra-phản-ứng-của-hệ-thống-khi-một-ứng-dụng-gặp-sự-cố>Kiểm tra phản ứng của hệ thống khi một ứng dụng gặp sự cố</h2><p>Với toàn bộ cấu hình đã được thiết lập, chúng ta có thể quan sát cách hệ thống phản ứng khi một ứng dụng riêng lẻ gặp lỗi. Hình 5 minh họa chuỗi sự kiện xảy ra trong kịch bản lỗi ứng dụng này. Trong điều kiện bình thường, người dùng ở Region 1 luôn được định tuyến đến các ứng dụng trong Region 1, vì chúng ta đã tạo Route 53 alias record sử dụng latency-based routing policy. Giả sử app1 gặp lỗi. Trong trường hợp đó, người dùng ở Region 1 truy cập app1 sẽ được chuyển hướng sang Region 2. Trong khi đó, người dùng ở Region 1 gửi yêu cầu đến app2 vẫn tiếp tục được phục vụ bởi app2 ở Region 1.</p><p><img alt=Blog src=../../../images/3-Blog/blog_1_4.jpg></p><p>Hình 5: Kịch bản lỗi ứng dụng</p><p>Chuỗi sự kiện được thể hiện trong Hình 5 như sau:</p><ol><li>Cả hai health check đều đang ở trạng thái ổn định.</li><li>Workload của app1 bị lỗi ở Region 1.</li><li>Route 53 health check (cho app1 ở Region 1) chuyển sang trạng thái bất ổn định.</li><li>Route 53 loại bỏ ALB của Region 1 ra khỏi DNS response.</li><li>Tất cả người dùng được chuyển hướng đến app1 ở Region 2.</li></ol><p>Xác minh hành vi như Hình 5, để mô phỏng tình huống ứng dụng lỗi, bạn có thể giảm số replica của app1 về 0, bằng lệnh sau:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl scale deployment demoapp1 --replicas<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span></code></pre></div><p>Trong ví dụ này, chúng ta sử dụng default timers của Route 53 health check. Do đó, sẽ mất vài phút để Route 53 bắt đầu chuyển hướng yêu cầu của người dùng từ Region 1 sang Region 2 cho app1. Bạn có thể cấu hình timer ngắn hơn (aggressive timers) để quá trình failover diễn ra nhanh hơn phù hợp với yêu cầu của mình.
Điểm khác biệt chính của phương pháp này là Phương pháp này có ưu thế nổi bật. Route 53 health check ở cấp ứng dụng chỉ phát hiện sự cố của app1 và chuyển hướng riêng traffic của app1 sang Region 2. Trong khi đó, app2 vẫn tiếp tục phục vụ người dùng ở Region 1, đảm bảo độ trễ tối ưu cho ứng dụng khỏe mạnh.</p><p>Hành vi failover chọn lọc này hoàn toàn khác biệt so với cơ chế giám sát ở cấp ALB truyền thống, nơi mà chỉ cần một ứng dụng lỗi sẽ khiến tất cả ứng dụng khác phải failover sang vùng khác, làm giảm hiệu năng không cần thiết cho các dịch vụ vẫn hoạt động bình thường. Giải pháp của chúng tôi đảm bảo rằng việc cách ly lỗi (failure isolation) diễn ra ở cấp ứng dụng, không phải ở cấp hạ tầng, giúp bạn kiểm soát chi tiết thực sự trong môi trường multi-tenant.</p><h2 id=những-điều-cần-biết>Những điều cần biết</h2><ul><li>Mỗi ứng dụng tiêu tốn 1 rule endpoint và 1 rule healthcheck trên ALB. Chú ý giới hạn số rule.</li><li>Khi tạo alias record bằng console, Evaluate target health tự động sẽ là Yes. Nếu dùng AWS CLI hoặc các công cụ khác thì phải tự đặt.</li><li>Cần cấu hình health check cho từng ứng dụng (có chi phí Route 53 health check).</li><li>Route 53 health check dạng HTTPS không xác thực SSL/TLS certificate. Vậy nên check sẽ không thất bại tại certificate quá hạn hoặc invalid.</li><li>Health check không giám sát IP private; nếu chạy trong private subnet, bạn có thể dùng custom health check với CloudWatch Alarm. Một custom health check sẽ sử dụng function Lambda (tham khảo bài Performing Route 53 health checks on private resources in a VPC with AWS Lambda and Amazon CloudWatch).</li><li>Cấu hình HTTP keepalive duration của ALB quan trọng để client phát hiện lỗi nhanh. Nếu muốn biết thêm thông tin, tham khảo Application Load Balancer enables configuring HTTP client keepalive duration.</li><li>Bài viết này không áp dụng cho mô hình path-based segregation (ví dụ: example.com/app1, example.com/app2).</li><li>Tham khảo: Configuring DNS Failover để biết thêm về cách thức health check, alias records, failover work tại nhiều trường hợp.</li><li>Dịch vụ Amazon Application Recovery Controller (ARC) cũng có thể giúp đạt Regional resiliency, nhưng ARC nằm ngoài phạm vi bài viết này. Để biết thêm thông tin chi tiết, vui lòng liên hệ ARC Developer Guide.</li></ul><h2 id=dọn-dẹp-tài-nguyên>Dọn dẹp tài nguyên</h2><p>Bạn sẽ tiếp tục phát sinh chi phí cho đến khi xóa toàn bộ cơ sở hạ tầng được tạo trong quá trình thực hiện hướng dẫn này. Hãy sử dụng các lệnh sau để xóa các tài nguyên đã tạo.</p><p>Xóa các cụm EKS bằng các lệnh sau đây. eksctl sẽ tự động xóa toàn bộ tài nguyên ELB (bao gồm target groups, ALB, v.v.) — đây là các tài nguyên được ALB Controller tạo ra do yêu cầu Kubernetes ingress.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>eksctl delete cluster --name<span style=color:#f92672>=</span>$Region1ClusterName --region<span style=color:#f92672>=</span>$Region1
</span></span><span style=display:flex><span>eksctl delete cluster --name<span style=color:#f92672>=</span>$Region2ClusterName --region<span style=color:#f92672>=</span>$Region2
</span></span></code></pre></div><p>Xóa các Route 53 alias record</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws route53 change-resource-record-sets --hosted-zone-id $HostedZoneId <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --change-batch <span style=color:#e6db74>&#34;{\&#34;Changes\&#34;:[{\&#34;Action\&#34;:\&#34;DELETE\&#34;,\&#34;ResourceRecordSet\&#34;:{\&#34;Name\&#34;:\&#34;</span>$app1hostname<span style=color:#e6db74>\&#34;,\&#34;Type\&#34;:\&#34;A\&#34;,\&#34;SetIdentifier\&#34;:\&#34;</span>$Region1<span style=color:#e6db74>\&#34;,\&#34;Region\&#34;:\&#34;</span>$Region1<span style=color:#e6db74>\&#34;,\&#34;HealthCheckId\&#34;:\&#34;</span>$HealthCheckRegion1App1Id<span style=color:#e6db74>\&#34;,\&#34;AliasTarget\&#34;:{\&#34;HostedZoneId\&#34;:\&#34;</span>$Region1ALBHostedZoneId<span style=color:#e6db74>\&#34;,\&#34;DNSName\&#34;:\&#34;</span>$Region1ALB<span style=color:#e6db74>\&#34;,\&#34;EvaluateTargetHealth\&#34;:false}}}]}&#34;</span>
</span></span><span style=display:flex><span>aws route53 change-resource-record-sets --hosted-zone-id $HostedZoneId <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --change-batch <span style=color:#e6db74>&#34;{\&#34;Changes\&#34;:[{\&#34;Action\&#34;:\&#34;DELETE\&#34;,\&#34;ResourceRecordSet\&#34;:{\&#34;Name\&#34;:\&#34;</span>$app2hostname<span style=color:#e6db74>\&#34;,\&#34;Type\&#34;:\&#34;A\&#34;,\&#34;SetIdentifier\&#34;:\&#34;</span>$Region1<span style=color:#e6db74>\&#34;,\&#34;Region\&#34;:\&#34;</span>$Region1<span style=color:#e6db74>\&#34;,\&#34;HealthCheckId\&#34;:\&#34;</span>$HealthCheckRegion1App2Id<span style=color:#e6db74>\&#34;,\&#34;AliasTarget\&#34;:{\&#34;HostedZoneId\&#34;:\&#34;</span>$Region1ALBHostedZoneId<span style=color:#e6db74>\&#34;,\&#34;DNSName\&#34;:\&#34;</span>$Region1ALB<span style=color:#e6db74>\&#34;,\&#34;EvaluateTargetHealth\&#34;:false}}}]}&#34;</span>
</span></span><span style=display:flex><span>aws route53 change-resource-record-sets --hosted-zone-id $HostedZoneId <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --change-batch <span style=color:#e6db74>&#34;{\&#34;Changes\&#34;:[{\&#34;Action\&#34;:\&#34;DELETE\&#34;,\&#34;ResourceRecordSet\&#34;:{\&#34;Name\&#34;:\&#34;</span>$app1hostname<span style=color:#e6db74>\&#34;,\&#34;Type\&#34;:\&#34;A\&#34;,\&#34;SetIdentifier\&#34;:\&#34;</span>$Region2<span style=color:#e6db74>\&#34;,\&#34;Region\&#34;:\&#34;</span>$Region2<span style=color:#e6db74>\&#34;,\&#34;HealthCheckId\&#34;:\&#34;</span>$HealthCheckRegion2App1Id<span style=color:#e6db74>\&#34;,\&#34;AliasTarget\&#34;:{\&#34;HostedZoneId\&#34;:\&#34;</span>$Region2ALBHostedZoneId<span style=color:#e6db74>\&#34;,\&#34;DNSName\&#34;:\&#34;</span>$Region2ALB<span style=color:#e6db74>\&#34;,\&#34;EvaluateTargetHealth\&#34;:false}}}]}&#34;</span>
</span></span><span style=display:flex><span>aws route53 change-resource-record-sets --hosted-zone-id $HostedZoneId <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --change-batch <span style=color:#e6db74>&#34;{\&#34;Changes\&#34;:[{\&#34;Action\&#34;:\&#34;DELETE\&#34;,\&#34;ResourceRecordSet\&#34;:{\&#34;Name\&#34;:\&#34;</span>$app2hostname<span style=color:#e6db74>\&#34;,\&#34;Type\&#34;:\&#34;A\&#34;,\&#34;SetIdentifier\&#34;:\&#34;</span>$Region2<span style=color:#e6db74>\&#34;,\&#34;Region\&#34;:\&#34;</span>$Region2<span style=color:#e6db74>\&#34;,\&#34;HealthCheckId\&#34;:\&#34;</span>$HealthCheckRegion2App2Id<span style=color:#e6db74>\&#34;,\&#34;AliasTarget\&#34;:{\&#34;HostedZoneId\&#34;:\&#34;</span>$Region2ALBHostedZoneId<span style=color:#e6db74>\&#34;,\&#34;DNSName\&#34;:\&#34;</span>$Region2ALB<span style=color:#e6db74>\&#34;,\&#34;EvaluateTargetHealth\&#34;:false}}}]}&#34;</span>
</span></span></code></pre></div><p>Xóa các Route 53 health check</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws route53 delete-health-check --health-check-id $HealthCheckRegion1App1Id
</span></span><span style=display:flex><span>aws route53 delete-health-check --health-check-id $HealthCheckRegion1App2Id
</span></span><span style=display:flex><span>aws route53 delete-health-check --health-check-id $HealthCheckRegion2App1Id
</span></span><span style=display:flex><span>aws route53 delete-health-check --health-check-id $HealthCheckRegion2App2Id
</span></span></code></pre></div><p>Hãy xóa bất kỳ tài nguyên nào khác mà bạn đã tạo trong phần prerequisites, nếu chúng không còn cần thiết, để tránh phát sinh chi phí không mong muốn.</p><h2 id=kết-luận>Kết luận</h2><p>Trong bài viết này, chúng tôi đã minh họa cách khắc phục hạn chế quan trọng trong kiến trúc multi-Region, multi-tenant Amazon EKS: hành vi failover “all-or-nothing” khiến ứng dụng khỏe mạnh cũng bị ảnh hưởng.
Bằng cách triển khai Route 53 health check riêng cho từng ứng dụng, bạn có thể đạt được độ chính xác cao trong chiến lược failover, chỉ chuyển hướng lưu lượng của ứng dụng bị lỗi và giữ hiệu năng tối ưu cho các ứng dụng còn lại.
Giải pháp này giúp bạn duy trì lợi ích chi phí của hạ tầng dùng chung, đáp ứng yêu cầu diverse availability, và loại bỏ cross-Region latency không cần thiết trong trường hợp lỗi cục bộ.
Đã sẵn sàng để nâng cao multi-Region resilience của bạn? Hãy làm các bước tiếp theo:
Mở rộng health check vượt ra ngoài phản hồi HTTP cơ bản, bao gồm kiểm tra các phụ thuộc nghiệp vụ quan trọng.
Tích hợp với Amazon Application Recovery Controller (ARC) để tự động hóa quá trình khôi phục sau thảm họa.</p><p>Xác định những ứng dụng trong hệ thống của bạn hưởng lợi nhiều nhất từ failover độc lập, đặc biệt là các ứng dụng có SLA khác nhau hoặc cơ sở người dùng theo vùng địa lý riêng biệt.</p><p>Tài liệu tham khảo:
Amazon EKS Best Practices Guide
Best Practices for Amazon Route 53
Designing for high availability and resiliency in Amazon EKS applications</p><h2 id=giới-thiệu-về-tác-giả>Giới thiệu về tác giả</h2><h3 id=dumlu-timuralp>Dumlu Timuralp</h3><p><img alt=Blog src=../../../images/3-Blog/blog_1_5.png>
Dumlu Timuralp là Senior Solutions Architect tại AWS, trụ sở tại Vương quốc Anh. Ông tư vấn kiến trúc về di chuyển lên cloud, hiện đại hóa ứng dụng và các mô hình cloud native. Ông yêu thích việc giúp người dùng đáp ứng nhu cầu kinh doanh thông qua công nghệ.</p><h3 id=pratik-mankad>Pratik Mankad</h3><p><img alt=Blog src=../../../images/3-Blog/blog_1_6.jpeg>
Pratik Mankad là Network Solutions Architect tại AWS. Anh đam mê công nghệ mạng và luôn sáng tạo để giải quyết vấn đề của khách hàng. Anh thiết kế giải pháp và cung cấp hướng dẫn kỹ thuật nhằm giúp người dùng và đối tác đạt được mục tiêu kỹ thuật lẫn kinh doanh của họ.</p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=../../../vi/3-blogstranslated/ title="Các Blog đã Dịch"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=../../../vi/3-blogstranslated/3.2-blog2/ title="Blog 2" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=../../../js/clipboard.min.js?1765299477></script><script src=../../../js/perfect-scrollbar.min.js?1765299477></script><script src=../../../js/perfect-scrollbar.jquery.min.js?1765299477></script><script src=../../../js/jquery.sticky.js?1765299477></script><script src=../../../js/featherlight.min.js?1765299477></script><script src=../../../js/highlight.pack.js?1765299477></script><script>hljs.initHighlightingOnLoad()</script><script src=../../../js/modernizr.custom-3.6.0.js?1765299477></script><script src=../../../js/learn.js?1765299477></script><script src=../../../js/hugo-learn.js?1765299477></script><link href=../../../mermaid/mermaid.css?1765299477 rel=stylesheet><script src=../../../mermaid/mermaid.js?1765299477></script><script>mermaid.initialize({startOnLoad:!0})</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,(e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date),(i=t.createElement(n),a=t.getElementsByTagName(n)[0]),i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-158079754-2","auto"),ga("send","pageview")</script></body></html>